<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="twitter:description" content="How the async code looks like, How to make it more readable and look like non-async code. Extending Future capabilities to match our needs."/><meta data-react-helmet="true" name="twitter:title" content="Writing Async App in Scala. Part 1: Coding"/><meta data-react-helmet="true" name="twitter:creator" content="Dmitry Komanov"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="og:type" content="website"/><meta data-react-helmet="true" name="og:description" content="How the async code looks like, How to make it more readable and look like non-async code. Extending Future capabilities to match our needs."/><meta data-react-helmet="true" name="og:title" content="Writing Async App in Scala. Part 1: Coding"/><meta data-react-helmet="true" name="description" content="How the async code looks like, How to make it more readable and look like non-async code. Extending Future capabilities to match our needs."/><meta name="theme-color" content="#663399"/><meta name="generator" content="Gatsby 4.19.2"/><style data-href="/styles.675be5d6b2b2ed53eac8.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}article{border-bottom:1px solid #f2f2f0;padding:40px 0}article:last-child{border-bottom:0}article .post-title{display:block;font-size:28px;font-style:normal;font-weight:700;letter-spacing:-.02em;line-height:1.1;margin:0}article .post-teaser{float:left;height:100px;padding:0 10px 0 0;width:100px}article .post-description{color:#666665;font-size:20px;font-style:normal;font-weight:300;letter-spacing:-.02em;line-height:1.3}article .teaser-padding{margin-left:110px}article .post-meta{color:#b3b3b1;font-size:14px;line-height:30px}article .post-meta time{margin:0 1em 0 0;vertical-align:middle}ul.pagination{list-style:none;margin:1em 0 0;padding:0}ul.pagination li{color:#b3b3b1;float:left;padding:0 10px 0 0}ul.pagination li.active{font-weight:700}ul.pagination li a,ul.pagination li a:visited{color:#b3b3b1;text-decoration:none}.btn{background-color:transparent;border:none;cursor:pointer;display:inline;margin:0;outline:0;padding:0;text-decoration:underline}.btn:focus,.btn:hover{text-decoration:none}.table-toggler{text-align:center}.table-toggler a{border-bottom:1px dotted #000;cursor:pointer;font-size:.7em}.raw-data-table table{width:100%}.raw-data-table table th{background-color:rgba(0,0,0,.03)}.raw-data-table table .right{text-align:right}.markdown div.choose ul{margin:.5em 0 0;padding:0}.markdown div.choose ul li:first-child{border-radius:5px 0 0 5px}.markdown div.choose ul li:last-child{border-radius:0 5px 5px 0}.markdown div.choose ul li{background-color:rgba(0,0,0,.05);color:rgba(0,0,0,.68);cursor:pointer;line-height:1.4;margin:0;min-width:40px;padding:3px .5em;text-align:center}.markdown div.choose ul li:hover{background-color:rgba(0,0,0,.15)}.markdown div.choose ul li.active{background-color:rgba(0,0,0,.15);cursor:default}.markdown div.choose label{background-color:rgba(0,0,0,.05);color:rgba(0,0,0,.68);display:inline-block;font-size:23px;margin:0 .5em 0 0;padding:5px;vertical-align:bottom}body{text-rendering:optimizeLegibility;-webkit-font-feature-settings:"liga";font-feature-settings:"liga";font-family:Open Sans,MundoSans,Helvetica Neue,Arial,Helvetica,sans-serif;font-size:1.2em;margin:0;padding:0}a{color:#333332}a,a:hover{text-decoration:none}.cf:after{clear:both;content:"";display:table}ul.horizontal{display:inline-block;list-style:none;margin:0;padding:0;vertical-align:top}ul.horizontal li{float:left}.site-header{box-sizing:border-box;margin:0 auto;max-width:740px;padding:0;position:relative;top:-140px;width:100%;z-index:2}.site-header .site-logo{background-color:#fff;background-image:url(data:image/jpeg;base64,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);background-size:cover;border:3px solid #fff;border-radius:50%;box-shadow:0 1px 1px rgba(0,0,0,.3);height:120px;margin-right:-60px;position:absolute;right:50%;text-indent:-9999px;top:-60px;width:120px;z-index:99}.site-header .site-title{color:#fff;font-size:50px;font-weight:700;letter-spacing:-2px;line-height:50px;margin:0;outline:0;padding:84px 16px 8px;text-align:center;word-break:break-word}.site-header .site-description{color:#666;font-size:18px;font-weight:400;line-height:1.5;margin:0 0 20px;padding:0 32px;text-align:center}.site-content{box-sizing:border-box;margin:0 auto;max-width:740px;position:relative;top:-140px;width:100%}.wide-content{display:block;left:50%;margin-left:-48vw;margin-right:-48vw;position:relative;right:50%;width:96vw}@media only screen and (max-width:800px){.site-content{padding:0 32px}}.markdown{color:#333;width:100%}.markdown,.markdown h1,.markdown h2,.markdown h3{font-family:Linux Libertine,serif}.markdown h3,.markdown h4,.markdown h5,.markdown h6{font-family:Linux Libertine,serif;font-size:24px;font-style:normal;font-weight:700;letter-spacing:-.02em;line-height:1.3;margin:0 0 4px}.markdown h1,.markdown h2{font-size:32px;font-style:normal;font-weight:700;letter-spacing:-.02em;line-height:1.2;margin-bottom:4px;padding-top:31px}.markdown p{color:#333;font-size:22px;font-style:normal;font-weight:400;-webkit-hyphens:auto;hyphens:auto;line-height:30px;margin:0;padding-bottom:30px}.markdown a{color:#333;text-decoration:underline}.markdown img{margin:0 auto;max-width:100%}.markdown figure{margin:0;padding:0 0 30px}.markdown figcaption{color:#666665;font-size:16px;font-style:italic;font-weight:400;line-height:1.3;outline:0;text-align:center;z-index:300}.markdown hr{border:0;border-top:1px solid #ddd;display:block;margin:30px auto;padding:0;width:15%}.markdown blockquote,.markdown li blockquote{border-left:3px solid #57ad68;margin:0 0 30px -26px;padding-left:20px}.markdown blockquote p,.markdown li blockquote p{border-left:3px solid #57ad68;font-style:italic;font-weight:400;letter-spacing:.01rem;margin-left:-26px;padding-bottom:3px;padding-left:20px}.markdown ol,.markdown ul{margin:0;padding:0 0 30px}.markdown li{font-size:23px;font-style:normal;font-weight:400;line-height:30px;margin-bottom:12px;margin-left:30px;padding:2px 0 0}.markdown li p{padding:0 0 1.618rem}.markdown ol li{list-style-type:decimal}.markdown code{font-family:Courier,monospace;font-size:16px}.markdown.tiny *{font-size:16px;line-height:1.2em}.markdown.tiny ul{padding:0}.markdown.tiny ul li{margin-bottom:0}footer{color:#999;font-size:12px;line-height:17.6px;margin:0 auto;max-width:640px;padding:22px 0;text-align:center;width:100%}footer a{color:#666;text-decoration:none}footer a:hover{color:#333}.share-buttons{display:inline-block}.share-buttons .share-button{display:inline-block;margin:0 0 0 .5em;text-align:center;vertical-align:top}.site-menu{color:#ccc;margin:0 0 50px;text-align:center}.site-menu a{color:#999;padding-left:20px;text-decoration:none}.site-menu a:hover{color:#333}.site-menu a.active{font-weight:700}.tag-cloud a{margin:6px}ul.tags{display:inline-block;list-style:none;margin:0;padding:0;vertical-align:top}ul.tags li{background-color:rgba(0,0,0,.05);border-radius:3px;float:left;line-height:1.4;margin:4px .5em 0 0;padding:3px 5px}ul.tags li:hover{background-color:rgba(0,0,0,.15)}ul.tags li.label{padding:0 .5em 0 0}ul.tags li a,ul.tags li a:visited{color:rgba(0,0,0,.68);text-decoration:none}.teaser-image{background-color:#000;height:360px;overflow:hidden;position:relative}.teaser-image_image{background-position:50%;background-size:cover;bottom:0;left:0;position:absolute;right:0;text-indent:-9999px;top:0;z-index:1}.time-units p.small{margin:0 0 10px}.time-units small{color:rgba(0,0,0,.3);font-size:11px}.site-content.no-cover{position:relative;top:0}.no-cover .post-meta{padding-top:60px}.no-cover .post-title{color:#333332;font-size:50px;font-style:normal;font-weight:700;letter-spacing:-.04em;line-height:1.1;margin-bottom:16px}.no-cover .author-image{background-image:url(/img/top-logo.jpg);background-size:cover;border-radius:100%;display:inline-block;float:left;height:30px;line-height:30px;margin-bottom:-10px;margin-right:8px;text-indent:-9999px;width:30px}.no-cover .author-name{display:inline}.no-cover .post-meta-text{color:#b3b3b1;font-size:14px;font-style:normal;font-weight:400;letter-spacing:-.02em;text-overflow:ellipsis;white-space:nowrap}.blog-post-meta{color:#b3b3b1}ul.what-i-read{list-style-type:none;margin:0;padding:0}ul.what-i-read>li{display:inline-block;padding:0 10px 0 0}</style><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Severe Software Developer Blog" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=994a873755adc623fbc44f1a9a107c69" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=994a873755adc623fbc44f1a9a107c69"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=994a873755adc623fbc44f1a9a107c69"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=994a873755adc623fbc44f1a9a107c69"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=994a873755adc623fbc44f1a9a107c69"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=994a873755adc623fbc44f1a9a107c69"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=994a873755adc623fbc44f1a9a107c69"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=994a873755adc623fbc44f1a9a107c69"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=994a873755adc623fbc44f1a9a107c69"/><title data-react-helmet="true">Writing Async App in Scala. Part 1: Coding | @dkomanov</title><link data-react-helmet="true" rel="canonical" href="https://medium.com/@dkomanov/writing-async-app-in-scala-part-1-coding-dd09b014d576"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="teaser-image"><div class="teaser-image_image" style="background-image:url(/static/aac741ab23d741e93808fb1effe02d8d/cover.jpg);transform:translate3d(0px, 0px, 0px);opacity:1">Teaser Image</div></div><header class="site-header"><a class="site-logo" href="/">@dkomanov</a><h1 class="site-title">@dkomanov</h1><div class="site-description">Severe Software Developer Blog</div><div class="site-menu"><a href="/">Blog</a><a href="/what-i-read">What I Read</a><a href="/what-i-listen">What I Listen</a><a href="/about">About</a></div></header><div class="site-content"><div class="blog-post" itemscope="" itemType="http://schema.org/Article"><h1>Writing Async App in Scala. Part 1: Coding</h1><div class="markdown " role="main"><h1 id="part-1-coding" style="position:relative;"><a href="#part-1-coding" aria-label="part 1 coding permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Part 1. Coding</h1>
<blockquote>
<p>In this part we will cover the most basic part of async programming in Scala with Futures. <br>
Part 1. Coding. <br>
<a href="/p/writing-async-app-in-scala-part-2-exception-handling">Part 2. Exception Handling.</a> <br>
<a href="/p/writing-async-app-in-scala-part-3-threading-model">Part 3. Threading Model.</a> <br>
Part 4. Rewrite Blocking App. <br>
Part 5. What’s next?</p>
</blockquote>
<p>Today asynchronous programming gets some traction. Some may argue even some hype. However, there are cases when it’s really necessary (or, let’s put it mildly, favorably). In this blog post I’d like to put aside reasons behind writing an application in an async fashion, it’s a separate topic. Here I want to focus on the practical side of this topic - how it looks like, what we have to do in order to make it simpler, and what problems we may encounter. Everything here is based on my personal experience, so I hope it won’t be too academic.</p>
<p>Another thing, I’m not going to explore different approaches of achieving asynchronicity (actor model, functional approaches, etc.) I’ve chosen approach with <a href="https://docs.scala-lang.org/overviews/core/futures.html">Future model</a> of Scala because of the least additional cost of learning. This concept is easier understandable both for me and for people around me: leap from sync jala (java style on Scala) programming to Futures is just shorter.</p>
<p>This post is written under the assumption that the reader is familiar with the concept of Future/Promise model and familiar with its implementation in Scala. If not, I would advise to read these articles first: <a href="https://alexn.org/blog/2017/01/30/asynchronous-programming-scala.html">Asynchronous Programming and Scala</a> by <a href="https://alexn.org/">Alexandru Nedelcu</a> and <a href="https://danielwestheide.com/blog/the-neophytes-guide-to-scala-part-8-welcome-to-the-future/">The Neophyte’s Guide to Scala Part 8: Welcome to the Future
</a> by <a href="https://danielwestheide.com/">Daniel Westheide</a> (entire Neophyte’s Guide is awesome!).</p>
<p>After such a long disclaimer, I have one more thing to say. A kind of application that I’m having in mind is simple: a backend for DB (not really important which one) with some REST/RPC exposure to the world (or internal world), which may also communicate via the network with other applications. Regular “web” application, without any CPU heavy operations (like image processing or blockchain computations.)</p>
<h2 id="regular-web-application" style="position:relative;"><a href="#regular-web-application" aria-label="regular web application permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Regular web application</h2>
<p>In our synchronous world, the application may look like this:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> validateRequest<span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  require<span class="token punctuation">(</span>request <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> regularRpcEndpoint<span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> Response <span class="token operator">=</span> <span class="token punctuation">{</span>
  validateRequest<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isPermittedViaRpc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> PermissionDeniedException<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">val</span> fromDb <span class="token operator">=</span> retrieveFromDatabase<span class="token punctuation">(</span>request<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token keyword">val</span> payload <span class="token operator">=</span> convertPayloadFromDb<span class="token punctuation">(</span>fromDb<span class="token punctuation">)</span>
  Response<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>By the end of this series I hope it will be clear, how to rewrite application in asynchronous way and avoid some dangers of async approach.</p>
<h2 id="writing-in-async-fashion" style="position:relative;"><a href="#writing-in-async-fashion" aria-label="writing in async fashion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Writing in async fashion</h2>
<p>NB: For simplicity let’s not think about <code class="language-text">implicit ec: ExecutionContext</code> argument for Future operations yet. I will cover this topic in next parts.</p>
<p>A straight-forward rewrite would look like:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> regularRpcEndpoint<span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span>Response<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  validateRequest<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

  isPermittedViaRpc<span class="token punctuation">.</span>flatMap <span class="token punctuation">{</span> isPermitted <span class="token keyword">=></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isPermitted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Future<span class="token punctuation">.</span>failed<span class="token punctuation">(</span><span class="token keyword">new</span> PermissionDeniedException<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      retrieveFromDatabase<span class="token punctuation">(</span>request<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>map<span class="token punctuation">(</span>convertPayloadFromDb<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>map<span class="token punctuation">(</span>Response<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In the following examples, I’ll show how to write a bit prettier…</p>
<h3 id="if-statement-replacement" style="position:relative;"><a href="#if-statement-replacement" aria-label="if statement replacement permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>if-statement replacement</h3>
<p>Suppose we have old-school future-less code:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> condition<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">def</span> action1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> action2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  action1<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  action2<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>How it would look like with futures? Suppose, all methods use some kind of IO inside, so:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> condition<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">def</span> action1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> action2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

condition<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span>
    action1<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span>
    action2<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Pretty straight-forward, right?</p>
<h3 id="boolean-operations" style="position:relative;"><a href="#boolean-operations" aria-label="boolean operations permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Boolean operations</h3>
<p>What if there are multiple conditions?</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> condition1<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> condition2<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> condition3<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>condition1 <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>condition2 <span class="token operator">||</span> condition3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></div>
<p>There aren’t much help from scala-library itself here, so let’s extend it a bit:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">implicit</span> <span class="token keyword">class</span> FutureOfBooleanExtensions<span class="token punctuation">(</span><span class="token keyword">val</span> future<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> <span class="token builtin">AnyVal</span> <span class="token punctuation">{</span>
  <span class="token keyword">def</span> <span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>other<span class="token operator">:</span> <span class="token keyword">=></span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    future<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>value <span class="token keyword">=></span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> Future<span class="token punctuation">.</span>successful<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">else</span> other<span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token operator">||</span><span class="token punctuation">(</span>other<span class="token operator">:</span> <span class="token keyword">=></span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    future<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>value <span class="token keyword">=></span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> Future<span class="token punctuation">.</span>successful<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">else</span> other<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And now, with these extension methods we will get this:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> condition1<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> condition2<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> condition3<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">val</span> condition <span class="token operator">=</span> condition1 <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>condition2 <span class="token operator">||</span> condition3<span class="token punctuation">)</span>
condition<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">else</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Nice, right?</p>
<p>We can go further, for example, if some of conditions aren’t IO-bound, or already calculated, we can just extend it a little bit more:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">implicit class BooleanToFutureExtensions(val v: Boolean) extends AnyVal {
  def &amp;&amp;(other: => Future[Boolean]): Future[Boolean] =
    if (v) other else Future.successful(false)

  def ||(other: => Future[Boolean]): Future[Boolean] =
    if (v) Future.successful(true) else other
}</code></pre></div>
<p>And use it:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> condition1<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> condition2<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> condition3<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">val</span> condition <span class="token operator">=</span> condition1 <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>condition2 <span class="token operator">||</span> condition3<span class="token punctuation">)</span>
condition<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">else</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Same code, but now we can mix <code class="language-text">Future[Boolean]</code> and <code class="language-text">Boolean</code>. Well, almost… We also need to add corresponding extension methods to <code class="language-text">Future[Boolean]</code> for commutativity, which is a bit more complex, because we can’t overload method with arguments <code class="language-text">=> Boolean</code> and <code class="language-text">=> Future[Boolean]</code>, so we need to use some implicit magic (called <a href="https://nrinaudo.github.io/scala-best-practices/definitions/type_class.html">type classes</a>):</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">implicit</span> <span class="token keyword">class</span> FutureOfBooleanExtensions<span class="token punctuation">(</span><span class="token keyword">val</span> future<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> <span class="token builtin">AnyVal</span> <span class="token punctuation">{</span>
  <span class="token keyword">def</span> <span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>other<span class="token operator">:</span> <span class="token keyword">=></span> BooleanOrFutureOfBoolean<span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    v<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span>
        other <span class="token keyword">match</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> Bool<span class="token punctuation">(</span>otherValue<span class="token punctuation">)</span> <span class="token keyword">=></span> Future<span class="token punctuation">.</span>successful<span class="token punctuation">(</span>otherValue<span class="token punctuation">)</span>
          <span class="token keyword">case</span> Fut<span class="token punctuation">(</span>future<span class="token punctuation">)</span> <span class="token keyword">=></span> future
        <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
        Future<span class="token punctuation">.</span>successful<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@implicitNotFound</span><span class="token punctuation">(</span><span class="token string">"This method supports only arguments of type Boolean OR Future[Boolean]"</span><span class="token punctuation">)</span>
<span class="token keyword">sealed</span> <span class="token keyword">trait</span> BooleanOrFutureOfBoolean

<span class="token keyword">object</span> BooleanOrFutureOfBoolean <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token keyword">class</span> Bool<span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> BooleanOrFutureOfBoolean
  <span class="token keyword">case</span> <span class="token keyword">class</span> Fut<span class="token punctuation">(</span>future<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> BooleanOrFutureOfBoolean

  <span class="token keyword">implicit</span> <span class="token keyword">def</span> `<span class="token builtin">Boolean</span> to BooleanOrFutureOfBoolean`<span class="token punctuation">(</span>v<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> BooleanOrFutureOfBoolean <span class="token operator">=</span> Bool<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  <span class="token keyword">implicit</span> <span class="token keyword">def</span> `Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> to BooleanOrFutureOfBoolean`<span class="token punctuation">(</span>v<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> BooleanOrFutureOfBoolean <span class="token operator">=</span> Fut<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I hope you’ve got the idea: whatever regular boolean operation you need, just extend <code class="language-text">Future[Boolean]</code> and <code class="language-text">Boolean</code> classes to support it, and your code will look beautiful and simple.</p>
<h2 id="for-comprehensions-for-the-rescue" style="position:relative;"><a href="#for-comprehensions-for-the-rescue" aria-label="for comprehensions for the rescue permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>for-comprehensions for the rescue</h2>
<p>Another way of making code look like future-less code is usage of for-comprehensions. This topic is covered quite a lot (<a href="https://docs.scala-lang.org/overviews/core/futures.html#functional-composition-and-for-comprehensions">1</a>, <a href="https://contributors.scala-lang.org/t/sequencing-in-for-comprehensions/779">2</a>, <a href="https://stackoverflow.com/a/19046133/426397">3</a>). In short, it looks like this:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> getMovie<span class="token operator">:</span> Future<span class="token punctuation">[</span>Movie<span class="token punctuation">]</span>
<span class="token keyword">def</span> getActors<span class="token punctuation">(</span>movie<span class="token operator">:</span> Movie<span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span>Seq<span class="token punctuation">[</span>Actor<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> getPlot<span class="token punctuation">(</span>movie<span class="token operator">:</span> Movie<span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span>MoviePlot<span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token punctuation">{</span>
  movie <span class="token keyword">&lt;-</span> getMovie
  actors <span class="token keyword">&lt;-</span> getActors<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
  plot <span class="token keyword">&lt;-</span> getPlot<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">yield</span> MovieDescription<span class="token punctuation">(</span>movie<span class="token punctuation">,</span> actors<span class="token punctuation">,</span> plot<span class="token punctuation">)</span></code></pre></div>
<h4 id="dealing-with-filter" style="position:relative;"><a href="#dealing-with-filter" aria-label="dealing with filter permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dealing with filter</h4>
<p>Looks very familiar. But in real life, it’s more complicated:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> hasPermissions<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token punctuation">{</span>
  isPermitted <span class="token keyword">&lt;-</span> hasPermissions
  <span class="token keyword">if</span> isPermitted
  movie <span class="token keyword">&lt;-</span> getMovie
  <span class="token keyword">if</span> <span class="token operator">!</span>movie<span class="token punctuation">.</span>hidden
  actors <span class="token keyword">&lt;-</span> getActors<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
  plot <span class="token keyword">&lt;-</span> getPlot<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">yield</span> MovieDescription<span class="token punctuation">(</span>movie<span class="token punctuation">,</span> actors<span class="token punctuation">,</span> plot<span class="token punctuation">)</span></code></pre></div>
<p><code class="language-text">if</code> construct is supported (via <code class="language-text">withFilter</code> method of <code class="language-text">Future</code>), of course, but <code class="language-text">Future</code> will be resolved with <code class="language-text">NoSuchElementException</code>, without ability to understand what’s really happened there.</p>
<p>I came up with this solution (yes, another extension method):</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">implicit</span> <span class="token keyword">class</span> BooleanFutureExtensions<span class="token punctuation">(</span><span class="token keyword">val</span> future<span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> <span class="token builtin">AnyVal</span> <span class="token punctuation">{</span>
  <span class="token keyword">def</span> orFail<span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token keyword">=></span> Throwable<span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    future<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>t <span class="token keyword">=></span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>isSuccess <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>get<span class="token punctuation">)</span> Failure<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">else</span> t<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And now we can rewrite it in this form:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">for</span> <span class="token punctuation">{</span>
  _ <span class="token keyword">&lt;-</span> hasPermissions orFail <span class="token keyword">new</span> PermissionDeniedException<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span>
  movie <span class="token keyword">&lt;-</span> getMovie
  <span class="token keyword">if</span> <span class="token operator">!</span>movie<span class="token punctuation">.</span>hidden
  actors <span class="token keyword">&lt;-</span> getActors<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
  plot <span class="token keyword">&lt;-</span> getPlot<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">yield</span> MovieDescription<span class="token punctuation">(</span>movie<span class="token punctuation">,</span> actors<span class="token punctuation">,</span> plot<span class="token punctuation">)</span></code></pre></div>
<p>Now there will be <code class="language-text">PermissionDeniedException</code> if user doesn’t have permissions, but still <code class="language-text">NoSuchElementException</code> if movie is hidden. One of solutions might be this: instead of just comprehending <code class="language-text">getMovie</code>, we may make it slightly more complex:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala">movie <span class="token keyword">&lt;-</span> getMovie<span class="token punctuation">.</span>filter<span class="token punctuation">(</span><span class="token operator">!</span>_<span class="token punctuation">.</span>hidden<span class="token punctuation">)</span><span class="token punctuation">.</span>recoverWith <span class="token punctuation">{</span>
  <span class="token keyword">case</span> _<span class="token operator">:</span> NoSuchElementException <span class="token keyword">=></span> Future<span class="token punctuation">.</span>failed<span class="token punctuation">(</span><span class="token keyword">new</span> HiddenMovieException<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>As always, we can simplify it with simple extension method:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">implicit</span> <span class="token keyword">class</span> FutureExtensions<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">val</span> future<span class="token operator">:</span> Future<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> <span class="token builtin">AnyVal</span> <span class="token punctuation">{</span>
  <span class="token keyword">def</span> filterOrFail<span class="token punctuation">(</span>f<span class="token operator">:</span> T <span class="token keyword">=></span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> e<span class="token operator">:</span> <span class="token keyword">=></span> Throwable<span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span>
    future<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>value <span class="token keyword">=></span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> Future<span class="token punctuation">.</span>successful<span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token keyword">else</span> Future<span class="token punctuation">.</span>failed<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Much better now:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">for</span> <span class="token punctuation">{</span>
  _ <span class="token keyword">&lt;-</span> hasPermissions orFail <span class="token keyword">new</span> PermissionDeniedException<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span>
  movie <span class="token keyword">&lt;-</span> getMovie<span class="token punctuation">.</span>filterOrFail<span class="token punctuation">(</span><span class="token operator">!</span>_<span class="token punctuation">.</span>hidden<span class="token punctuation">,</span> <span class="token keyword">new</span> HiddenMovieException<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  actors <span class="token keyword">&lt;-</span> getActors<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
  plot <span class="token keyword">&lt;-</span> getPlot<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">yield</span> MovieDescription<span class="token punctuation">(</span>movie<span class="token punctuation">,</span> actors<span class="token punctuation">,</span> plot<span class="token punctuation">)</span></code></pre></div>
<h4 id="another-filter-related-consideration" style="position:relative;"><a href="#another-filter-related-consideration" aria-label="another filter related consideration permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Another filter-related consideration</h4>
<p>What I really don’t like about regular <code class="language-text">filter</code> is this <code class="language-text">NoSuchElementException</code>. When we use <code class="language-text">recover</code> or <code class="language-text">recoverWith</code> right after, it means, that this exception is created only to be catched very match soon and will be replaced with something else. In a hell for <del>perfectionists</del> people who waste their time on micro-optimizations there is a never-ending loop</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> NoSuchElementException
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> _<span class="token operator">:</span> NoSuchElementException <span class="token keyword">=></span>
<span class="token punctuation">}</span></code></pre></div>
<p>To deal with my control freak’s issue I’ve created simple singleton exception without a stack-trace:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">object ControlException extends Throwable("control", null, false, false) {
  def unapply(e: Throwable): Boolean = e.isInstanceOf[ControlException.type]
}</code></pre></div>
<p>And whenever I extend <code class="language-text">Future</code> in a way that I need to call <code class="language-text">recover</code> method after, I use this <code class="language-text">ControlException</code> which literally has close to zero overhead. Of course, I have convenient extension methods supporting it:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">implicit</span> <span class="token keyword">class</span> FutureExtensions<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">val</span> future<span class="token operator">:</span> Future<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> <span class="token builtin">AnyVal</span> <span class="token punctuation">{</span>
  <span class="token keyword">def</span> recoverFilter<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token keyword">=></span> T<span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span>
    future<span class="token punctuation">.</span>recover <span class="token punctuation">{</span>
      <span class="token keyword">case</span> _<span class="token operator">:</span> NoSuchElementException <span class="token operator">|</span> ControlException <span class="token keyword">=></span> f
    <span class="token punctuation">}</span>

  <span class="token keyword">def</span> recoverFilterWith<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token keyword">=></span> Future<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span>
    future<span class="token punctuation">.</span>recoverWith <span class="token punctuation">{</span>
      <span class="token keyword">case</span> _<span class="token operator">:</span> NoSuchElementException <span class="token operator">|</span> ControlException <span class="token keyword">=></span> f
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h4 id="dealing-with-option" style="position:relative;"><a href="#dealing-with-option" aria-label="dealing with option permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dealing with Option</h4>
<p>Another problem with for-comprehensions is that you can’t mix different monads (like <code class="language-text">Option</code>). Because in real life it’s quite common to expose methods like:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> findMovie<span class="token punctuation">(</span>title<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span>Option<span class="token punctuation">[</span>Movie<span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre></div>
<p>In this case, in for-comprehensions in this expression <code class="language-text">movie &lt;- findMovie("Dark Waters")</code> the type of <code class="language-text">movie</code> will be <code class="language-text">Option[Movie]</code>, not <code class="language-text">Movie</code>. Which is understandable, but we need to find out how to deal with it. One way is to expose Option-less version which resolves <code class="language-text">Future</code> with some <code class="language-text">Exception</code>. Another approach is, as you may already have guessed, to create a convenient extension method:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">implicit</span> <span class="token keyword">class</span> FutureOfOptionExtensions<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">val</span> v<span class="token operator">:</span> Future<span class="token punctuation">[</span>Option<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> <span class="token builtin">AnyVal</span> <span class="token punctuation">{</span>
  <span class="token keyword">def</span> orFail<span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token keyword">=></span> Throwable<span class="token punctuation">)</span><span class="token operator">:</span> Future<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span>
    v<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>fold<span class="token punctuation">[</span>Future<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span>Future<span class="token punctuation">.</span>failed<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> Future<span class="token punctuation">.</span>successful<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And usage:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">for</span> <span class="token punctuation">{</span>
  movie <span class="token keyword">&lt;-</span> findMovie<span class="token punctuation">(</span><span class="token string">"Dark Waters"</span><span class="token punctuation">)</span> orFail <span class="token keyword">new</span> MovieNotFoundException<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">yield</span> movie</code></pre></div>
<h2 id="conclusion" style="position:relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>This part is the most basic of async programming: coding in async fashion. But still, when I started to write more and more code I realized how vanilla Scala is not sufficient to do most of the work — I import my extensions in every second file where I write something with Futures.</p>
<p>And because <code class="language-text">Future</code> functionality is very limited out of the box, don’t hesitate to extend it to make the life easier and the code more readable.</p>
<p>All code is available on <a href="https://github.com/dkomanov/stuff/tree/master/src/com/komanov/future">GitHub</a>. Originally posted on <a href="https://medium.com/@dkomanov/writing-async-app-in-scala-part-1-coding-dd09b014d576">Medium</a>. <a href="https://pixabay.com/photos/technology-keyboard-computing-785742/">Image</a> by <a href="https://pixabay.com/users/Pixies-1021586/?utm_source=link-attribution&#x26;utm_medium=referral&#x26;utm_campaign=image&#x26;utm_content=785742">Daniel Agrelo</a> from <a href="https://pixabay.com/?utm_source=link-attribution&#x26;utm_medium=referral&#x26;utm_campaign=image&#x26;utm_content=785742">Pixabay</a>.</p></div></div><div class="blog-post-meta"><ul class="tags"><li class="cf"><a href="/posts/scala">scala</a></li><li class="cf"><a href="/posts/async">async</a></li><li class="cf"><a href="/posts/coding">coding</a></li></ul><hr/><div class="share-buttons"><button aria-label="twitter" class="react-share__ShareButton share-button" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="24" height="24"><rect width="64" height="64" rx="0" ry="0" fill="#00aced"></rect><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="facebook" class="react-share__ShareButton share-button" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="24" height="24"><rect width="64" height="64" rx="0" ry="0" fill="#3b5998"></rect><path d="M34.1,47V33.3h4.6l0.7-5.3h-5.3v-3.4c0-1.5,0.4-2.6,2.6-2.6l2.8,0v-4.8c-0.5-0.1-2.2-0.2-4.1-0.2 c-4.1,0-6.9,2.5-6.9,7V28H24v5.3h4.6V47H34.1z" fill="white"></path></svg></button></div></div></div><footer>All content ©<!-- --> <a href="mailto:dkomanov@gmail.com">Dmitry Komanov</a>,<!-- --> <a href="/powered">powered by...</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/p/writing-async-app-in-scala-part-1-coding/";window.___webpackCompilationHash="7192cf1744603a470e57";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-f1d5be50dbe1d5fc9ecc.js"],"app":["/app-1b9468ff546f1dad0c9f.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-99a953a5d5072d737c00.js"],"component---src-pages-404-js":["/component---src-pages-404-js-d311d0c14a6bd17dfdcb.js"],"component---src-pages-charts-mysql-streaming-index-js":["/component---src-pages-charts-mysql-streaming-index-js-a48d5f3b78e19f89817d.js"],"component---src-pages-charts-read-lines-index-js":["/component---src-pages-charts-read-lines-index-js-efd8cc612d9c09935797.js"],"component---src-pages-charts-read-utf-8-index-js":["/component---src-pages-charts-read-utf-8-index-js-11fbad01eb1168c3858e.js"],"component---src-pages-charts-region-matches-index-tsx":["/component---src-pages-charts-region-matches-index-tsx-db6bff67a14f5ce2e141.js"],"component---src-pages-charts-scala-serialization-index-js":["/component---src-pages-charts-scala-serialization-index-js-8031e44c374498443654.js"],"component---src-pages-charts-scala-string-format-index-js":["/component---src-pages-charts-scala-string-format-index-js-1f1cc83aa422bb12b1fb.js"],"component---src-pages-index-js":["/component---src-pages-index-js-89b9502773a9c85a5d28.js"],"component---src-templates-blog-by-tag-js":["/component---src-templates-blog-by-tag-js-4a20511be4b662e46145.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-72d890085c5bfd932504.js"],"component---src-templates-static-js":["/component---src-templates-static-js-1bfbee0247e4250c5e9c.js"],"component---src-templates-what-i-listen-list-tsx":["/component---src-templates-what-i-listen-list-tsx-78541c11d35977090566.js"],"component---src-templates-what-i-listen-single-episode-tsx":["/component---src-templates-what-i-listen-single-episode-tsx-7b2b201033a53beee2dd.js"],"component---src-templates-what-i-listen-tag-cloud-tsx":["/component---src-templates-what-i-listen-tag-cloud-tsx-327c66099e94fb90a770.js"],"component---src-templates-what-i-read-index-js":["/component---src-templates-what-i-read-index-js-491c475db57164b668a4.js"]};/*]]>*/</script><script src="/polyfill-f1d5be50dbe1d5fc9ecc.js" nomodule=""></script><script src="/app-1b9468ff546f1dad0c9f.js" async=""></script><script src="/framework-bf670a827ae315f850d0.js" async=""></script><script src="/webpack-runtime-5ac5080c187b8f4e237e.js" async=""></script></body></html>