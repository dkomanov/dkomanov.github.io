{"componentChunkName":"component---src-templates-blog-post-js","path":"/p/mysql-blob-fetch-performance-in-java/","result":{"data":{"markdownRemark":{"id":"1e1edf14-a8b4-520e-863f-db02c6b6c923","excerpt":"What’s the best way to store binary data in MySQL? This is a question that has multiple answers, depending on what you want to achieve. For example, if you need…","html":"<p>What’s the best way to store binary data in <a href=\"https://www.mysql.com/\">MySQL</a>? This is a question that has multiple answers, depending on what you want to achieve. For example, if you need to optimize for the storage size, you probably need to use some compression algorithm that compresses your data efficiently. In my case, I really need the best performance, meaning the fastest response time to fetch the entire blob from MySQL.</p>\n<p>Let’s put aside the question of whether MySQL is a good fit for <a href=\"https://dba.stackexchange.com/questions/2445/should-binary-files-be-stored-in-the-database\">storing binary data</a>. The question here, is how to store binary data so the reads from DB are as fast as possible?</p>\n<p>The solution might be to use data compression. However, this is something that requires benchmarking, as there is a trade off between using CPU for decompression and network speed. In this benchmark I am going to compare performance between different compression algorithms, compression using MySQL itself and not using compression at all.</p>\n<h2 id=\"benchmark-environment\" style=\"position:relative;\"><a href=\"#benchmark-environment\" aria-label=\"benchmark environment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Benchmark Environment</h2>\n<p>This benchmark is slightly less micro and slightly more complicated than my usual benchmarks. We have 3 major parameters here: MySQL Server, network between MySQL and Application and compression algorithms.</p>\n<h3 id=\"datasets-and-compression-algorithms\" style=\"position:relative;\"><a href=\"#datasets-and-compression-algorithms\" aria-label=\"datasets and compression algorithms permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Datasets and Compression Algorithms</h3>\n<p>Because this blog post is a continuation of my previous one — <a href=\"/p/java-compression-performance\">Java Compression Performance</a>, I’m going to use the same compression algorithms and datasets as there. Let’s briefly describe it.</p>\n<p>In short, there are 2 datasets:</p>\n<ul>\n<li>One is based on the real user data, contains URLs, UUID etc.</li>\n<li>Another is <a href=\"https://github.com/dkomanov/stuff/blob/4e7dd1ff5ffc3354115b90f29ef3c14ec2ebd96b/src/com/komanov/compression/BlobCompressionRatio.java\">purely random</a>, using different alphabet sizes to achieve different compression ratios.</li>\n</ul>\n<p>Application level compression using these algorithms: <a href=\"https://en.wikipedia.org/wiki/Gzip\">gzip</a>, <a href=\"https://en.wikipedia.org/wiki/Deflate\">deflate</a>, <a href=\"https://dev.mysql.com/doc/refman/8.0/en/encryption-functions.html#function_compress\">MySQL compression</a>, <a href=\"https://github.com/facebook/zstd\">zstd</a>, <a href=\"https://github.com/google/snappy\">snappy</a>, <a href=\"https://github.com/google/brotli\">brotli</a> and <a href=\"https://lz4.github.io/lz4/\">lz4</a>.</p>\n<p>In additional to application-level compression, we’re going to use internal <a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-compression-internals.html\">MySQL compression</a> as well.</p>\n<p>Compression ratios for different algorithms and datasets you may explore in <a href=\"https://docs.google.com/spreadsheets/d/1pFOAgxVYsos38oraeva1_RHC9P4J3oN2Oj2fQ65L8OI\">this spreadsheet</a>.</p>\n<h3 id=\"blob-in-mysql\" style=\"position:relative;\"><a href=\"#blob-in-mysql\" aria-label=\"blob in mysql permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BLOB in MySQL</h3>\n<p>MySQL has <a href=\"https://dev.mysql.com/doc/refman/8.0/en/blob.html\">BLOB</a> column type which allows to store binary data (check <a href=\"https://dev.mysql.com/doc/refman/8.0/en/storage-requirements.html#data-types-storage-reqs-strings\">docs</a> for the maximum length, and also <a href=\"https://dev.mysql.com/doc/refman/8.0/en/optimize-blob.html\">few tips</a> for using BLOB).</p>\n<p>Another aspect is the MySQL’s storage <a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html\">row format</a>. Depending on row format, MySQL stores data differently.</p>\n<ul>\n<li><code class=\"language-text\">DYNAMIC</code> row format for <code class=\"language-text\">BLOB</code> stores 20-byte pointer to where it’s stored. As opposed to <code class=\"language-text\">REDUNDANT</code> and <code class=\"language-text\">COMPACT</code> row formats, which store first 768 bytes in a table and the rest in overflow pages. In this benchmark data sizes start from 1028 bytes, so this kind of optimization is irrelevant.</li>\n<li><code class=\"language-text\">COMPRESSED</code> row format enables <a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-compression-internals.html\">compression</a> on database level, so 20-byte pointer will point to another storage which will be compressed using <a href=\"https://dev.mysql.com/doc/refman/8.0/en/encryption-functions.html#function_compress\">deflate with 4-byte length prefix</a>. For the benchmark sake we will use the same algorithm on application level to see the overhead of MySQL over compression. You may find useful another blog post with overview of <a href=\"https://medium.com/datadenys/data-compression-in-mysql-6a0668af8f08\">MySQL compression</a>.</li>\n</ul>\n<p>So, the first table structure we’re going to use is this:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uncompressed_blobs<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">INT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">MEDIUMBLOB</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> ROW_FORMAT<span class=\"token operator\">=</span>DYNAMIC<span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this table we will store either uncompressed data or data compressed on an application level without using MySQL compression (obviously, we want to avoid double compression as it ineffective).</p>\n<p>And another table for benchmarking MySQL’s compression:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>compressed_blobs<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">INT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">MEDIUMBLOB</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> ROW_FORMAT<span class=\"token operator\">=</span>COMPRESSED<span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"network-and-hardware\" style=\"position:relative;\"><a href=\"#network-and-hardware\" aria-label=\"network and hardware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Network and Hardware</h3>\n<p>For this benchmark I ended up with 4 different configurations:</p>\n<ul>\n<li><code class=\"language-text\">localhost</code>. This is the most naive and “in a vacuum” configuration. Both JMH benchmark and MySQL were run on a same laptop (i7-1165G7, 16GB RAM, Ubuntu 22). This configuration provides the best “network” latencies, and allegedly without too much contention, as 2 threads were used for the JMH benchmark and the rest for MySQL (which was underutilized anyway).</li>\n<li><code class=\"language-text\">AWS</code>. I used the actual production cluster of MySQL Server with master/slaves with <a href=\"https://proxysql.com/\">proxysql</a> in front of it. JMH benchmark was run on a separate server inside the same region.</li>\n<li><code class=\"language-text\">1Gbit</code> is so-called configuration that I ran on my home network. MySQL server was installed on an old computer with Atom processor, and a JMH benchmark was run from another laptop (i7-U10610U, 32GB RAM, Ubuntu 20).\n<ul>\n<li>First run using Wi-Fi.</li>\n<li>And another one using Ethernet (I don’t have Ethernet port on a laptop from <code class=\"language-text\">localhost</code> configuration)</li>\n</ul>\n</li>\n</ul>\n<p>Because compression performance doesn’t really depend on JDK version (as I shown in my <a href=\"/p/java-compression-performance\">previous benchmark</a>), I used different versions of JDK (openjdk-11 in <code class=\"language-text\">AWS</code> and openjdk-17 on my laptops).</p>\n<h2 id=\"benchmarks\" style=\"position:relative;\"><a href=\"#benchmarks\" aria-label=\"benchmarks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Benchmarks</h2>\n<p>For this benchmark the most important metric is a throughput: how many bytes of uncompressed data we can get in a second. Response time can’t show a meaningful result because it doesn’t include compression ratio.</p>\n<h3 id=\"benchmarks-for-aws-configuration\" style=\"position:relative;\"><a href=\"#benchmarks-for-aws-configuration\" aria-label=\"benchmarks for aws configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Benchmarks for AWS configuration</h3>\n<p>I’d guess that the most interesting results are for <code class=\"language-text\">AWS</code> configuration as it’s closest to a potential production use case.</p>\n<p>Here we may see the throughput chart for real dataset and data sizes between 600KB and 4MB:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/67ab251376e970162c5c904317cd6326/7de21/aws-real-big.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHklEQVQoz5WSiW6DMBBE+f/PpAGMMRAOH+C1X2WSVFErVcpKo9Veo9m1KxEhpUTO+TO8ZiSSRJjvFu8dVSH8mKwAyEnIwYFE3NTjnKfy3v+rsNRSTg9f+q74SeY2cjxJWZi3gRiFylr7h+A9/m1XTiLZ7yzWsoSDMwrrfbtql8Jn5/vU5YTMGSMhRmw8cEfAeUvwO8ZajPMsIXCUG27uUl8VmWYc6FVN39/QRmOmETNq9NBjJsMwKFRzo2tbtNLUStGqjn3SuHkgnoF9mYkiVMcR0E3N2HUsXcfY1CjVodsvpuaLe9+xjQa/Lhzbit9WjmUmWUvyHvGOXB62nKGs/LgZj0M/t72+RMqknDnPiA8BSekHJV/UlO3KLyl42TfLvHHAriTIzAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS, real dataset, large BLOBs, throughput bytes per second\"\n        title=\"AWS, real dataset, large BLOBs, throughput bytes per second\"\n        src=\"/static/67ab251376e970162c5c904317cd6326/50383/aws-real-big.png\"\n        srcset=\"/static/67ab251376e970162c5c904317cd6326/1d79a/aws-real-big.png 185w,\n/static/67ab251376e970162c5c904317cd6326/1efb2/aws-real-big.png 370w,\n/static/67ab251376e970162c5c904317cd6326/50383/aws-real-big.png 740w,\n/static/67ab251376e970162c5c904317cd6326/73caa/aws-real-big.png 1110w,\n/static/67ab251376e970162c5c904317cd6326/536c7/aws-real-big.png 1480w,\n/static/67ab251376e970162c5c904317cd6326/7de21/aws-real-big.png 1839w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Let’s highlight the best:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7310e695a67b06fbb102b4c8c92d5f5a/7de21/aws-real-big-highlight.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVQoz52S4W7bMAyE/f7PuCZ26i1tEtuJbEqWSOkr5CTYWvRPR4AAJfGOJ5KNmZFzppTyM68YIMeAxcg4LYgsNJXwv8k0kcYTJa346YQPgSaEcFf4SeXfuL599UpWTEnvr5hfyNkY5zOqRiMid3BN+qf6k/BbWz3r5Y3LPDPGREiKuy5b/qaQRy94EmiCbFsYgseJsHjhNjvG8zvT8ZWTm1nUSGZoLgxONjFNjJHfbceha+m7ltOfnsPLjn73wn6/p2sPHA8t3a8d3a7l2L/RD47zVXBOuDkhJd0KVa4mrivTcEZuDpmuyDRwFc9tnpkvA+qFbEqpwzPDVCmaKKrkuiHbUDOW0tbf5r4ykB99zIU7+DGkmBLee1QVrd97ej0/7uqmPO0DG4dxFnH3DuoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS, real dataset, large BLOBs, highlighted, throughput bytes per second\"\n        title=\"AWS, real dataset, large BLOBs, highlighted, throughput bytes per second\"\n        src=\"/static/7310e695a67b06fbb102b4c8c92d5f5a/50383/aws-real-big-highlight.png\"\n        srcset=\"/static/7310e695a67b06fbb102b4c8c92d5f5a/1d79a/aws-real-big-highlight.png 185w,\n/static/7310e695a67b06fbb102b4c8c92d5f5a/1efb2/aws-real-big-highlight.png 370w,\n/static/7310e695a67b06fbb102b4c8c92d5f5a/50383/aws-real-big-highlight.png 740w,\n/static/7310e695a67b06fbb102b4c8c92d5f5a/73caa/aws-real-big-highlight.png 1110w,\n/static/7310e695a67b06fbb102b4c8c92d5f5a/536c7/aws-real-big-highlight.png 1480w,\n/static/7310e695a67b06fbb102b4c8c92d5f5a/7de21/aws-real-big-highlight.png 1839w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You may see, that lz4 takes the lead over uncompressed BLOB and every other algorithm is slower. Bigger the BLOB, the difference is more significant.</p>\n<p>Let’s take a look on a smaller dataset — 34KB to 94KB:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d5c53a9bf80a8c65efdcfd8af0dcbde0/161ec/aws-real-medium.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMUlEQVQoz5WS4W7kIAyE8/5PeXfbbLZJAyEESLDhO8F21fZnkYwxeMYjm0FEKKVQa/2lFUqpXLmQpbK5SIyB4VdkQN+vhKazE2m71EwwMyEmhqbwJ5Du+ebbqqrUnKkpEuyBM57oLP5YiTngjpV8ZYYY4xPQyEqhiPRYiuJOT5ATVaGKoFlx1rPtO7u3LMvEZj/IObP70PUPKaVPCRXyBXKhybFuCz4c2M0wzQ8edmUcR+7TjdVMOLeSgucyhhwT7ji7oEFU+6O3D65gsHbh3zRi5gU/f3A8Jvwys003jm2hSKRW7b1sBLXUPlS3O1SVQXJmfvvL7T7yZ7zz9v7OZhznvnN6h2h+DqM+m/k6fw2qNxs9E9oUNlYRfSYXetXXauBWveU0e/2I5stnXov1G+Y/lMBxu0xjP6oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS, real dataset, medium BLOBs, throughput bytes per second\"\n        title=\"AWS, real dataset, medium BLOBs, throughput bytes per second\"\n        src=\"/static/d5c53a9bf80a8c65efdcfd8af0dcbde0/50383/aws-real-medium.png\"\n        srcset=\"/static/d5c53a9bf80a8c65efdcfd8af0dcbde0/1d79a/aws-real-medium.png 185w,\n/static/d5c53a9bf80a8c65efdcfd8af0dcbde0/1efb2/aws-real-medium.png 370w,\n/static/d5c53a9bf80a8c65efdcfd8af0dcbde0/50383/aws-real-medium.png 740w,\n/static/d5c53a9bf80a8c65efdcfd8af0dcbde0/73caa/aws-real-medium.png 1110w,\n/static/d5c53a9bf80a8c65efdcfd8af0dcbde0/536c7/aws-real-medium.png 1480w,\n/static/d5c53a9bf80a8c65efdcfd8af0dcbde0/161ec/aws-real-medium.png 1840w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The picture is more interesting here, but it’s mostly because compression ratio for lz4 for particular examples is significantly worse. However, it’s important to note this — compression ratio matters a lot. And to illustrate this point let’s check the performance for random dataset for different compression ratios:</p>\n<p><img src=\"/585113c5653cd557d42b2118651abc2d/aws-stub.gif\" alt=\"AWS, stub dataset, different compression ratios, throughput bytes per second\"></p>\n<p>You may see: bigger the size and better the compression ratio — lz4 outperforms everything else more and more.</p>\n<h3 id=\"benchmarks-for-localhost\" style=\"position:relative;\"><a href=\"#benchmarks-for-localhost\" aria-label=\"benchmarks for localhost permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Benchmarks for localhost</h3>\n<p>What <code class=\"language-text\">localhost</code> benchmark really shows is the ideal case in which network is as fast as possible.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fc28e97cc81b1d61c07e9b16bf9c81bd/7de21/localhost-real-big.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQklEQVQoz02Si7KkIAxE/f8f3Z1Rh1E0JCFwtsS17k1VV0MTmkcyRQStNXrvdLj5mf/Goz187ZNMt0KLIH1PShGmYTgSKt2U3uLH+DeG9qAPI3pjRAvk80KkMJVSoJygQnelS4aod+LjcB1yres5GMk0N7w1ajSiBSnP1BpM53li0fHoRIdaG5ozdunHMaBHRopxqiPqnB7sVvmIkoriEezfPG4+iQhfLSxFWIuyqvKRk3QeJC3spuzmZDc2K2ymfFXYVSjmAx6NlGX871Rrxd0xFaxkVAsejoVTVBEriBeyFtQcM0O9IuLkPXPknXDn2BI1gsnN2JaV9Hfm82cmvRbSe2WfV3JK5OVDnmckJY5lYXu92N9v8rLiW8L3L636XfXryVfLXJ8arQ3h4qvyAy0wN67C3e11a+1/zl2QPsZP/AN/5HHadjxLCAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"localhost, real dataset, large BLOBs, throughput bytes per second\"\n        title=\"localhost, real dataset, large BLOBs, throughput bytes per second\"\n        src=\"/static/fc28e97cc81b1d61c07e9b16bf9c81bd/50383/localhost-real-big.png\"\n        srcset=\"/static/fc28e97cc81b1d61c07e9b16bf9c81bd/1d79a/localhost-real-big.png 185w,\n/static/fc28e97cc81b1d61c07e9b16bf9c81bd/1efb2/localhost-real-big.png 370w,\n/static/fc28e97cc81b1d61c07e9b16bf9c81bd/50383/localhost-real-big.png 740w,\n/static/fc28e97cc81b1d61c07e9b16bf9c81bd/73caa/localhost-real-big.png 1110w,\n/static/fc28e97cc81b1d61c07e9b16bf9c81bd/536c7/localhost-real-big.png 1480w,\n/static/fc28e97cc81b1d61c07e9b16bf9c81bd/7de21/localhost-real-big.png 1839w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We may see that uncompressed performance is better than any other algorithm significantly except for lz4.</p>\n<p>If you remember, on the chart from <code class=\"language-text\">AWS</code> configuration for mid-sized BLOBs lz4 didn’t perform as well something (because of bad compression ratio). However, when you improve throughput of MySQL (network), lz4 continues to shine:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9d0c351647b56c316dc5dccbfb6330b6/bcec6/localhost-real-medium.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPElEQVQoz42RyY7cMAxE/f+/GSQ9jW7LWqyVywvsTAZzSyQUCB6KeCxuIoKZ4e7/J8DXxOfAnbs3c2Ks9N7Y/jmMP6b7mWK9snpjjo62E1TBjRae1NbZxhjfBnwzX40ZqGCzI71ylkTunSpCF6UOoaTCmoOjvLm23VprnwPAZd3mi2DUTD0zqWTepRBrZaow1RhLqHMyVW8AVSMd5Ya6CXstxHgQUmJPmeOspD5JY1GXYP4X2lFX7PpudJkMmZg7oTTcjO3CbKoMVxaOXVF95nZVdWOaMHTdmmvRxry1VOgmLBPOdCCqbHrlkQNnDOTjRd6f5P1FDIH0fnPugbxHwnNnfzwIP39Qng/ix5P91wfpFZA5cdX72pvIosRIL4WeEy0FRs60fFJT4syXTqRPTORr9VtmtFKYY3wd8jdOFHHKBSmpLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"localhost, real dataset, medium BLOBs, throughput bytes per second\"\n        title=\"localhost, real dataset, medium BLOBs, throughput bytes per second\"\n        src=\"/static/9d0c351647b56c316dc5dccbfb6330b6/50383/localhost-real-medium.png\"\n        srcset=\"/static/9d0c351647b56c316dc5dccbfb6330b6/1d79a/localhost-real-medium.png 185w,\n/static/9d0c351647b56c316dc5dccbfb6330b6/1efb2/localhost-real-medium.png 370w,\n/static/9d0c351647b56c316dc5dccbfb6330b6/50383/localhost-real-medium.png 740w,\n/static/9d0c351647b56c316dc5dccbfb6330b6/73caa/localhost-real-medium.png 1110w,\n/static/9d0c351647b56c316dc5dccbfb6330b6/536c7/localhost-real-medium.png 1480w,\n/static/9d0c351647b56c316dc5dccbfb6330b6/bcec6/localhost-real-medium.png 1834w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"benchmarks-for-local-network-and-weak-server\" style=\"position:relative;\"><a href=\"#benchmarks-for-local-network-and-weak-server\" aria-label=\"benchmarks for local network and weak server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Benchmarks for local network and weak server</h3>\n<p>Even though it is pretty much unlikely to encounter such configuration in a real production environment, it may show something interesting.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f909fed8f392540dfbc01e36334dd37b/7de21/ethernet-real-big.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQ0lEQVQoz42S3W7kIAxG8/6PuBerdqdNp5NMAgk/AducFZltVfWiWiRjjMzxh2GotWJmtNZ+NPu6NoPWEBWSVNQazkVyTgxfgWYP+wTZN5jZJ6yosHhPDBGTQlpvxJQZjuP4L4VyggEapTXWfUNTAlFUhXWfEFGG1DeBXli0oXaGXQQqj6DP3m+EPZCqsYeIeoeGiOweqxXvwln4BEa34KY33PuFbR7RUqkp4+4Tu99Y7zP+PrK5K/PtD/v0zN7jcCccnipdYTpbMpRauN5G5vnK4lem91cuz794G5+YbhdeX35zHZ8I+8K2rXg3s4eutFJNyf3KZgS/IqoMIsKRhZgqKVW2KCyLZ1k9IVZyVlJWQhRCEHLqVsmxUHOh5EJTo6mcj3cCVRUzPSW37lt79NGUkjM5BvT8DXrm6of/d677j/EX1o9wmY1cb7QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1GBit Ethernet, real dataset, large BLOBs, throughput bytes per second\"\n        title=\"1GBit Ethernet, real dataset, large BLOBs, throughput bytes per second\"\n        src=\"/static/f909fed8f392540dfbc01e36334dd37b/50383/ethernet-real-big.png\"\n        srcset=\"/static/f909fed8f392540dfbc01e36334dd37b/1d79a/ethernet-real-big.png 185w,\n/static/f909fed8f392540dfbc01e36334dd37b/1efb2/ethernet-real-big.png 370w,\n/static/f909fed8f392540dfbc01e36334dd37b/50383/ethernet-real-big.png 740w,\n/static/f909fed8f392540dfbc01e36334dd37b/73caa/ethernet-real-big.png 1110w,\n/static/f909fed8f392540dfbc01e36334dd37b/536c7/ethernet-real-big.png 1480w,\n/static/f909fed8f392540dfbc01e36334dd37b/7de21/ethernet-real-big.png 1839w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Here we clearly see that uncompressed BLOB gives about 30MB/sec, and for that it’s hard to show any good results for fast algorithms. And in such circumstances brotli shines as it has the best compression ratio among all algorithms, so the poor throughput of MySQL is well compensated by a big compression ratio and reasonable decoding performance (I want to remind you, that 11th level of brotli is extremely slow on encoding).</p>\n<h3 id=\"comparisons\" style=\"position:relative;\"><a href=\"#comparisons\" aria-label=\"comparisons permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Comparisons</h3>\n<p>I also did a couple interesting (in my view) comparisons.</p>\n<h4 id=\"mysql-compression-algorithm\" style=\"position:relative;\"><a href=\"#mysql-compression-algorithm\" aria-label=\"mysql compression algorithm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MySQL Compression Algorithm</h4>\n<p>The first comparison is between <code class=\"language-text\">ROW_FORMAT=COMPRESSED</code> and using <a href=\"https://dev.mysql.com/doc/refman/8.0/en/encryption-functions.html#function_uncompress\">UNCOMPRESS</a> function of MySQL over compressed data in <code class=\"language-text\">ROW_FORMAT=DYNAMIC</code>. Basically, we compare how storage is organized versus simple decompression.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/25d5a0c2072ce1899179e3ea323a762a/de766/mysql-vs-mysql-localhost.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVQoz32S2w7lIAhF+/+fei6tWFTwtia26cx5GszKJrIhGt1aawxg9s4wZ7jTc2ao0mOkR6FLYJzxoh877f2mvV7UtZ8S+glIFHLObGNORk6Xsa+Gi5MShFYbWSJFE1acnJ2SjJIKrgm1SamTV1AkBFSVzXLC9wMtAzX+cmaQcxJ1ovkmlUlME9E7tzJobXDsH77fLyLCpjEiRyE7ZK9ocbQYpRreKmoZ9cRpCyXVdTIllhOxE2vG8Ia50Xtn0+zsp3EmIUggiiBBkEOQPXCGiB5KlkQOCQ16aZFEOpRanN/Y3J3P+4tpYZTKrJ3ZB/Rx65gw5+2e8x9PzMn84RqYU75rz/ox3D3zv/x6tnVvc6fWyhq+vtHKH10vZ2ZX/vDUFqv/d+Af4mRxB94IJjQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"localhost, Compressed Table vs UNCOMPRESS, throughput bytes per second\"\n        title=\"localhost, Compressed Table vs UNCOMPRESS, throughput bytes per second\"\n        src=\"/static/25d5a0c2072ce1899179e3ea323a762a/50383/mysql-vs-mysql-localhost.png\"\n        srcset=\"/static/25d5a0c2072ce1899179e3ea323a762a/1d79a/mysql-vs-mysql-localhost.png 185w,\n/static/25d5a0c2072ce1899179e3ea323a762a/1efb2/mysql-vs-mysql-localhost.png 370w,\n/static/25d5a0c2072ce1899179e3ea323a762a/50383/mysql-vs-mysql-localhost.png 740w,\n/static/25d5a0c2072ce1899179e3ea323a762a/73caa/mysql-vs-mysql-localhost.png 1110w,\n/static/25d5a0c2072ce1899179e3ea323a762a/536c7/mysql-vs-mysql-localhost.png 1480w,\n/static/25d5a0c2072ce1899179e3ea323a762a/de766/mysql-vs-mysql-localhost.png 1838w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Interestingly enough, doing <code class=\"language-text\">SELECT UNCOMPRESS(data)</code> is slightly faster than decompressing data automatically from the storage itself.</p>\n<p>The next step is to compare getting uncompressed data from MySQL via <code class=\"language-text\">SELECT UNCOMPRESS(data)</code> and getting compressed data from MySQL and decompressing it in an application itself. Basically, MySQL vs network+Java :)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/08606b647d54f88b1aea0ebd337d5b69/de766/java-vs-mysql-aws.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPUlEQVQoz6WS624UMQyF5/3frYIfBbVsZ6ZFQPfS3aVzSWzHyVcluxUI+IelT06s5OTYSpdSIudMKeXfwC/qPpd2PqeEp0QSobgz709EiXTu/pdAdr+QMylGbF1xVXSesWVG5wkLtSa4RJIltueZsC50qnoVo70or6/YPBHP5yYg00KcFjQIJolkmZRKw6xmcC+cji9M00y3rivvUczQNRIWI0yRpWYpiBWiFpborNEJcslRnKiOpYyLkdzp1LSJbcdvjB/uefrUM972fP8y8GMz8LwZ2PeP7Mav7PqRXf/Ifnhi/zBw6Ee29xvmw8vVUaErnhluPrP5eMfp+JOlthkCIoKpoKKEqIhcsDpLtbau9RAFT37VK3QahePzoan/T5Tr/S6X0npXs+ZKm4MLZkYIgTrn3+t/Ur/eu8M3PSpu/Aobf3gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS, Java vs UNCOMPRESS, throughput bytes per second\"\n        title=\"AWS, Java vs UNCOMPRESS, throughput bytes per second\"\n        src=\"/static/08606b647d54f88b1aea0ebd337d5b69/50383/java-vs-mysql-aws.png\"\n        srcset=\"/static/08606b647d54f88b1aea0ebd337d5b69/1d79a/java-vs-mysql-aws.png 185w,\n/static/08606b647d54f88b1aea0ebd337d5b69/1efb2/java-vs-mysql-aws.png 370w,\n/static/08606b647d54f88b1aea0ebd337d5b69/50383/java-vs-mysql-aws.png 740w,\n/static/08606b647d54f88b1aea0ebd337d5b69/73caa/java-vs-mysql-aws.png 1110w,\n/static/08606b647d54f88b1aea0ebd337d5b69/536c7/java-vs-mysql-aws.png 1480w,\n/static/08606b647d54f88b1aea0ebd337d5b69/de766/java-vs-mysql-aws.png 1838w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>As expected, lower network usage is very beneficial: uncompressing in Java is significantly faster. But with an ideal network (namely <code class=\"language-text\">localhost</code>), it’s not really the case:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f9a44d63962b221bf90b1a651aa55779/de766/java-vs-mysql-localhost.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABG0lEQVQoz2WSi27kIAxF8/8/WnXVzhDA2JjHqSCZqqMNOroXzMPEHO7OGGPTa6WZ4aoXpWxdY23F3C9evl794Y3074GacvTe6a3txWvi6J05J3PMS1tjul8s3xqMAc2h962jDz4eiSKZo66TREALVANV5l/MmLW+MaTgKeNnwrXuTB/fX8QYOVIItGdAtVN0IDqIchFy5yzzjbBYcZ3kMohlUley5rTeOUyVmJxQnFgMsUptFatGUUEkIzm9sa5WciJvImbK6zvUnM+vQD5P4jNwPgPhsfREoiCpkJMgWRHRN7WVQDG8tr3Z+ueHmXGGSL+LwPw97Oq//H+Nm9vfc3eVd2FWpd3x5pfeY6pKWc/nfjK/sT9+7fHK8AfoFHIX7zdjUAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"localhost, Java vs UNCOMPRESS, throughput bytes per second\"\n        title=\"localhost, Java vs UNCOMPRESS, throughput bytes per second\"\n        src=\"/static/f9a44d63962b221bf90b1a651aa55779/50383/java-vs-mysql-localhost.png\"\n        srcset=\"/static/f9a44d63962b221bf90b1a651aa55779/1d79a/java-vs-mysql-localhost.png 185w,\n/static/f9a44d63962b221bf90b1a651aa55779/1efb2/java-vs-mysql-localhost.png 370w,\n/static/f9a44d63962b221bf90b1a651aa55779/50383/java-vs-mysql-localhost.png 740w,\n/static/f9a44d63962b221bf90b1a651aa55779/73caa/java-vs-mysql-localhost.png 1110w,\n/static/f9a44d63962b221bf90b1a651aa55779/536c7/java-vs-mysql-localhost.png 1480w,\n/static/f9a44d63962b221bf90b1a651aa55779/de766/java-vs-mysql-localhost.png 1838w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We may see that only for highest compression ratio Java wins. In other cases MySQL is faster. Which probably means that <code class=\"language-text\">UNCOMPRESS</code> implementation from MySQL is faster (it makes sense as Java does plenty of memory copy and some allocations).</p>\n<h3 id=\"lz4-vs-uncompressed\" style=\"position:relative;\"><a href=\"#lz4-vs-uncompressed\" aria-label=\"lz4 vs uncompressed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>lz4 vs Uncompressed</h3>\n<p>Let’s take a slightly closer look on lz4 and uncompressed, as they are clear winners in <code class=\"language-text\">localhost</code> and <code class=\"language-text\">AWS</code> configurations. Here is the small animation to see lz4 vs uncompressed in all configurations:</p>\n<p><img src=\"/a20bce7e4f179aaba360384f7b9f4d12/lz4.gif\" alt=\"lz4 vs Uncompressed, stub dataset for all configurations, throughput bytes per second\"></p>\n<p>And here is lz4 vs uncompressed for <code class=\"language-text\">AWS</code> configuration. Uncompressed is highlighted, so it’s obvious that lz4 wins clearly:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a5bc309d077a08fe6ad548036927da35/de766/lz4-aws-highlight.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4klEQVQoz4WS624EIQiFff8H7a/dzo53BOY0OLidaZOW5AsKegJoGGNAVXEcxx94XgTHOqsKFXYEr+cDOWeEf8Usv4TMX/G7JrhtT6SUEXrvNwFdzAoEOuisgq0T8Tj72kRl3mM+96GUAjMLYqKOADDYkQv6jY9jmVeImeytIaWKV6zYc8deCbEOxDKQKiNWRm6M3BmpnVSSW4dBfB4pV3w8MrbYkCtPgXyhuJ/iZbzXexropO8ug/X+uRfEQrjb4fzc/2a17BUqausQHiAiEC1PsC9VSoXN+RqncT9rD7UEvwDshXZY0WtpNQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS, lz4 vs Uncompressed, throughput bytes per second\"\n        title=\"AWS, lz4 vs Uncompressed, throughput bytes per second\"\n        src=\"/static/a5bc309d077a08fe6ad548036927da35/50383/lz4-aws-highlight.png\"\n        srcset=\"/static/a5bc309d077a08fe6ad548036927da35/1d79a/lz4-aws-highlight.png 185w,\n/static/a5bc309d077a08fe6ad548036927da35/1efb2/lz4-aws-highlight.png 370w,\n/static/a5bc309d077a08fe6ad548036927da35/50383/lz4-aws-highlight.png 740w,\n/static/a5bc309d077a08fe6ad548036927da35/73caa/lz4-aws-highlight.png 1110w,\n/static/a5bc309d077a08fe6ad548036927da35/536c7/lz4-aws-highlight.png 1480w,\n/static/a5bc309d077a08fe6ad548036927da35/de766/lz4-aws-highlight.png 1838w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>For our particular use case lz4 looks very promising. When the compression ratio is not good, it loses slightly, but generally it outperforms anything else. The next option is not using compression at all.</p>\n<p>But it’s very important to remember that application level compression has some downsides:</p>\n<ul>\n<li>Data can’t be used within database. So, if you, for example, store JSON in a BLOB, you won’t be able to use JSON functions.</li>\n<li>It moves CPU computations from MySQL to your application (which could be an upside in some cases as well).</li>\n<li>It requires more effort from the application side.</li>\n</ul>\n<p>The next thing to be aware of is a compression ratio. Know you data, benchmark over your data, as the performance depends on an actual compression ratio significantly.</p>\n<p>And the last thing — a configuration of your environment also may affect the decision greatly, as for slower servers benchmark shows completely opposite results (maybe not completely, but close to it).</p>\n<p>Play with charts <a href=\"/charts/mysql-blog-fetch\">here</a>. Source code is on <a href=\"https://github.com/dkomanov/stuff/tree/4e7dd1ff5ffc3354115b90f29ef3c14ec2ebd96b/src/com/komanov/mysql/blob\">GitHub</a>. Originally posted on <a href=\"https://dkomanov.medium.com/mysql-blob-fetch-performance-in-java-d40460e856c\">Medium</a>. Cover image by <a href=\"https://openai.com/dall-e-2/\">DALL-E</a>: “a manometer with pipe with a dolphin on a background, 3d render” (yay! First time I managed to get something from it, even though it’s still not 100%-pretty :)).</p>","fields":{"slug":"/p/mysql-blob-fetch-performance-in-java/"},"frontmatter":{"rawDate":"2023-02-05T00:00:00.000Z","date":"February 05, 2023","title":"MySQL BLOB Fetch Performance in Java","description":"A performance benchmark: fetching BLOB column from MySQL uncompressed vs compressed with different algorithms!","tags":["java","mysql","compression","lz4","deflate","brotli","gzip","blob","benchmark","performance"],"canonicalUrl":"https://dkomanov.medium.com/mysql-blob-fetch-performance-in-java-d40460e856c","cover":{"publicURL":"/static/595e821066ff403c0e159cf18471e292/cover.png"}}}},"pageContext":{"slug":"/p/mysql-blob-fetch-performance-in-java/","previous":{"fields":{"slug":"/p/java-compression-performance/"}},"next":{"fields":{"slug":"/p/optimizing-performance-of-simple-version-parsing-in-scala/"}}}},"staticQueryHashes":["3675711862"]}