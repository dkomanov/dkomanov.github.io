{"componentChunkName":"component---src-templates-blog-post-js","path":"/p/mysql-as-redis-vs-redis/","result":{"data":{"markdownRemark":{"id":"866466c7-4227-54f5-9b09-1787fb5b7a1d","excerpt":"This is the next portion of my “research” around my UUID set cache. I’ve benchmarked Map Performance Java vs Scala, binary search instead of HashSet and even…","html":"<p>This is the next portion of my “research” around my UUID set cache. I’ve benchmarked <a href=\"/p/map-performance-java-vs-scala\">Map Performance Java vs Scala</a>, <a href=\"/p/replacing-hash-set-with-sorted-array-in-java\">binary search instead of HashSet</a> and even moving Set cache to <a href=\"/p/ultimate-off-heap-hash-set-using-redis\">Redis</a>. Now it’s time to benchmark <a href=\"https://www.mysql.com/\">MySQL</a> as such cache.</p>\n<p>This is a silly benchmark, I know. But just for the whole picture :) Hope I’m not going to benchmark other out-of-process stuff with it.</p>\n<p>However, I decided to test one more thing, related to <a href=\"https://en.wikipedia.org/wiki/Java_Database_Connectivity\">JDBC</a>, that I wanted to benchmark for a while, but didn’t have a good justification to actually spend time on it. Keep on reading!</p>\n<h2 id=\"what-are-we-testing\" style=\"position:relative;\"><a href=\"#what-are-we-testing\" aria-label=\"what are we testing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What are we testing?</h2>\n<p>My use case is simple - I have a large in-memory set of <a href=\"https://cr.openjdk.java.net/~iris/se/17/latestSpec/api/java.base/java/util/UUID.html\">UUID</a>, around 1 million keys. This is how I’m going to store it in MySQL:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> set1m <span class=\"token punctuation\">(</span>\n  id <span class=\"token keyword\">BINARY</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> ROW_FORMAT<span class=\"token operator\">=</span>DYNAMIC<span class=\"token punctuation\">;</span></code></pre></div>\n<p>A <a href=\"https://github.com/dkomanov/stuff/blob/18457ede0177648f611fdce9e962c403e4ac2a21/src/com/komanov/mysql/hashset/UuidHelper.java#L10\">code</a> to convert UUID to <code class=\"language-text\">BINARY(16)</code> (which is just an array of bytes in JDBC):</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">toBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UUID</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> array <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">ByteBuffer</span> bb <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    bb<span class=\"token punctuation\">.</span><span class=\"token function\">putLong</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">getMostSignificantBits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    bb<span class=\"token punctuation\">.</span><span class=\"token function\">putLong</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">getLeastSignificantBits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> array<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"benchmark\" style=\"position:relative;\"><a href=\"#benchmark\" aria-label=\"benchmark permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Benchmark</h2>\n<p>Benchmark <a href=\"https://github.com/dkomanov/stuff/blob/18457ede0177648f611fdce9e962c403e4ac2a21/src/com/komanov/mysql/hashset/perf/PerfTester.java\">code</a> is relatively simple: N threads take UUIDs one by one and make a simple query:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token number\">1</span> <span class=\"token keyword\">FROM</span> set1m <span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">=</span> ?</code></pre></div>\n<p>I benchmarked for one thread to 10 threads.</p>\n<h3 id=\"spice-it-up\" style=\"position:relative;\"><a href=\"#spice-it-up\" aria-label=\"spice it up permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spice It Up!</h3>\n<p>I was wondering about the overhead of connection pools for a while. At <a href=\"https://www.wix.com/\">Wix</a> we started to use <a href=\"https://github.com/brettwooldridge/HikariCP/\">HikariCP</a> a <a href=\"https://www.wix.engineering/post/how-does-hikaricp-compare-to-other-connection-pools\">while ago</a>. We discussed it with a <a href=\"https://twitter.com/nukemberg\">friend</a>, and he claimed that it’s not smart to use connection pools in blocking environment, that you can simply use thread locals with connections and some housekeeping and it would be much more efficient.</p>\n<p>There are some problems with this approach, of course:</p>\n<ul>\n<li>If Jetty (or any other servlet container) uses all its threads from the pool, then we would be using more connections than we actually should.</li>\n<li>Housekeeping is tricky. Also it’s impossible to warm-up connections or at least not simple (issue HTTP calls on startup?)</li>\n</ul>\n<p>Anyway, in the benchmark it’s a nice opportunity to actually check it without writing complex code for housekeeping of connections and such. So, this is what I did: compared HikariCP with pre-warmed up connections versus pre-warmed up connections stored in <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/ThreadLocal.html\">ThreadLocal</a>.</p>\n<h2 id=\"results\" style=\"position:relative;\"><a href=\"#results\" aria-label=\"results permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Results</h2>\n<p>Median query time doesn’t really depend on table size. However, 10M table is slightly slower (few microseconds):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f78ab60351e836052d781540ff6c609/e4c9a/all-sizes-median.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB50lEQVQ4y41Ti46bMBDk/z+vUtU2d5eqqbgLpoAxmIexPdXYbEKiqq2l1drG7M7OzhbWWozjmGxZFgzDkPbTND3YPM9wzv3TCv5clmWyrutQVVXaK1WhbdtklVLo+x7/s4oQAmKMqOsa3vu0R4xwPmK0U0Ib1gV2tPDbDDsasCq+Fdu2LXnGKnjgkgvvmSBgXCKaboDWHYLpodsOwWkYXcGYISXm+/xPBkJfSCCWxuBhzxqCBxDzwxgR0+m+JJAglHNBbhiMpAv0u23YnEOIgF8NluYC/XGG/qWwrOstSSDamKss2AjylzM8Bgwh/7Dqn1CnT7D1B1ynYMoz2vMXmPcTpvqMSb1ivHyG7ZqMkAEZ2LntVpZnAjfAXk+4vnzDvOayfdxR+Q1z38PULcZWY3NrqrAwxqDXOgfZZgztFbp8g33/iv7HCXV5zUFibkDYOU/q2JPfQEjJVaUSj+r7C9rLG/q6wWxG+BBTMFJB0UoDHmwXtHwrtNZomiZpL4Z7HxPhOyqRyNEfjXc3hORPKYV5WbCu60P2o2j/5o/qKDinnGF6EehRtEd7Rvr8LQUUuPTMRD7Eiz3f/+mdoLyNHmeWfLJJlBK9nOnZNBkC+c699IBq4V0aPUH4TPSzF+JxkImUysVp+w2rfODv6bB0wwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Median query duration by parallelism, microseconds\"\n        title=\"Median query duration by parallelism, microseconds\"\n        src=\"/static/0f78ab60351e836052d781540ff6c609/e4c9a/all-sizes-median.png\"\n        srcset=\"/static/0f78ab60351e836052d781540ff6c609/1d79a/all-sizes-median.png 185w,\n/static/0f78ab60351e836052d781540ff6c609/1efb2/all-sizes-median.png 370w,\n/static/0f78ab60351e836052d781540ff6c609/e4c9a/all-sizes-median.png 591w\"\n        sizes=\"(max-width: 591px) 100vw, 591px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>On the contrary, maximum query time seem to depend a bit on a table size. I’m wondering why? I set <a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_buffer_pool_size\">innodb_buffer_pool_size</a> to 1G, which is larger than table size.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebafa66bc0913d2e88ee2537fbf2ad81/e4c9a/all-sizes-max.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJUlEQVQ4y41Ua4/bIBD0//97Va+qqtOpd7k4wWBsAsY8pxoc+9xvhzTaXUyG2QfpnHOw1mJdVxhjwNh737AsS4v5Lcb4LXQk+/z8xDRNzfZ9DykllJIYlWqxXRZ8d3WllOZcLhfM89z8UjJirrB2aerLusI+LHLycNbAOoeSM/ITKaVmydUxqLU20C+lNkIXADkaaD2imBnTOKGmGWYSMObRzpOAIBlj2kPhMAythlwkRi2oDRU8sRHQ4vjxTnb2u73wTI3+l9LSbPOfaVH5tveVbj59a4TjOEII0QjYzf323Z5vP9tzujlXVAC5VHTsLgkJkpOI7T8rPBf+2CNIWFkig7wqpNWiY91IunW3HMU+F33zNxVtrwKFjUwrsvyDpN6Q72/I3mwKOXecN6XUoZBqaFPzK9JyRV4HRCqkGntBuL4gTnck80BhXZmy1roRHt19qsChpqKWgOJ71KhR/AdqnpHkgOp9O2dDRUjYmkJCKuNQE+SKkfVKSDEgpYLsBaKfkXlpDAjDgGImrKlC6AD9iNCPBOcTuj09pu6cpS6UGjeFT9QktncVPIoUgHewHHyTEVNpMwtsD6Ij2b6CmzH9/Qnz8YL5/Rfc9TeWyw8s/SvUZcDwfoPUHsIkDFN4djwihHhMwUHIV3EXCuKuMdwEtLhB9u9Q/QcmqXC/9pDa4D6MkErDzFPLiqNGsFws338Kz81otm7A8+ntaZ3Pn0eLf3n/AGES4GBgFtt+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Max query duration by parallelism, microseconds\"\n        title=\"Max query duration by parallelism, microseconds\"\n        src=\"/static/ebafa66bc0913d2e88ee2537fbf2ad81/e4c9a/all-sizes-max.png\"\n        srcset=\"/static/ebafa66bc0913d2e88ee2537fbf2ad81/1d79a/all-sizes-max.png 185w,\n/static/ebafa66bc0913d2e88ee2537fbf2ad81/1efb2/all-sizes-max.png 370w,\n/static/ebafa66bc0913d2e88ee2537fbf2ad81/e4c9a/all-sizes-max.png 591w\"\n        sizes=\"(max-width: 591px) 100vw, 591px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"hikaricp-vs-thread-local\" style=\"position:relative;\"><a href=\"#hikaricp-vs-thread-local\" aria-label=\"hikaricp vs thread local permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HikariCP vs Thread Local</h3>\n<p>Median time is consistently better for Thread Local, 3-8 microseconds difference. This is about 10% for querying localhost, but usually we query MySQL over the network, so it would be 1% or less of the overhead. Not great, not terrible.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d70a8699475f6667d1e8c6596e23927f/e4c9a/hikari-vs-thread-local.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVQ4y31UiY6bMBTk/z+vUqWVVq1W6iYkPjhCbMDYnmpeMCKI1tHg6zG8eUcq5xyez6dgHEdwT+zXBd77t3meZyzLghDChopEl8tF0DQNjDGo6xpt06CxFlpp3O8K2hi5b9tWbJRSQnYcVUoJOWdorRFjlHXOCUtM8GMQz9M8Y/YOfvRw3iOmCOQk9iQluE4pouKCoxwKaYqYQoLtPO7qjuQdTK3w8fM3Pn58QqkO05Lx+mF9QpzYCIunRFq9xGro/AL9xyC5EXkO8KaF/dYwaoC1DtY8Ya8N/MOh6vse1lpBCXKKL/DLw3PE7VeNOE/yoYV3/GiYMbUtJmsxNg3COMq7FYPM+HHQK/rkQ8bgFjSqh/q6SQyFJKU35FVDWhNCtVXXdeIdx+AC9K1HezXorhpT20s85aU1YSU0b+TrnRAOwyDlwPLoa4W565BikIxFSlyzWJK2n8/uKiHbJL/ydZR39CyfyS8eUjJJy8HR8Iz4iLiXTO9Y9Y/HA9M0nco5yjqCLbdJZl+SaJOc89t6vz/ORxt6K61XOmXf5Gf4n01RUJUGZ88ynqxLFjvnsi9x5nmZeV7uWHYMGfenrfevrJbixa6QSzI4+Jf3F5Cp4e+C7oKmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Median query duration by parallelism, microseconds\"\n        title=\"Median query duration by parallelism, microseconds\"\n        src=\"/static/d70a8699475f6667d1e8c6596e23927f/e4c9a/hikari-vs-thread-local.png\"\n        srcset=\"/static/d70a8699475f6667d1e8c6596e23927f/1d79a/hikari-vs-thread-local.png 185w,\n/static/d70a8699475f6667d1e8c6596e23927f/1efb2/hikari-vs-thread-local.png 370w,\n/static/d70a8699475f6667d1e8c6596e23927f/e4c9a/hikari-vs-thread-local.png 591w\"\n        sizes=\"(max-width: 591px) 100vw, 591px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"mysql-vs-redis\" style=\"position:relative;\"><a href=\"#mysql-vs-redis\" aria-label=\"mysql vs redis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MySQL vs Redis</h3>\n<p>Predictably, Redis has better performance than MySQL. Even though data set in MySQL is really small (hundreds of megabytes), overhead of SQL seems to be too significant.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/15a6326dd5cab22c18052ed4de99ea9a/e4c9a/mysql-vs-redis-median.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBElEQVQ4y31U2Y7kMAjM/3/kHg+jVnfi3HFiA65VkTjTO6tZSwiMHUIV4GbbNqzr6hJjvO19332/LIvvj+MA79JHLSLIOf8jDS9/fHy49H2PEILb4zgihA6PxwOv1wvLuiJ0nd+hfLcaM0MpBW3bQlXdpo9yZPNAe4yQGDEz+xhRAKjILcyW35oqGhpc1ekHZq6nzfB8tZinCToOeP78gfD7F+zYYVZgAKwUaCnnT8w+A9ZMq3CPYicOVUjogGMHcvLgGjrYusD2CI0bjL64oZmmyXmjpJQ801tKQT52pOcD+TjOPVGUAkkJeRyQ+4A09BCei6AZhsH5w5VyhWGkYJkhrycsJfeVi9tTLshvBTFTNGc1w+m4gmjfOUSdJye6XJdJhd7UnOEYfN0VczTsSdGwz9gGzPLoWuRphOR8FokQ3yhgUNOzeEcSjKvgNQr6JWOJ4nebGuwr5OKZXIVhZmqIqWDcFGExhEWxHeb+WrwbMoM6DNMrgEHUIGKYo2JYFe10wiI8Bqk/qy3mdLAPmR0nYZ5nhGlHvwjCnNFOgm4WzFvGfhDmO2T5qxs4cgzmVeZsck65khTsubiGlwK3Jg2+e9PvUnvZR69OikiGXlKHPaVP+7sHoZ45ZBpcfCTIJ/tyHKdLj7cmzxyCqumvZ2w7Usb9f0fvqz6nUO9Gfi8GF5+8P/Ee4ot8ogfwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MySQL vs Redis: median request duration, microseconds\"\n        title=\"MySQL vs Redis: median request duration, microseconds\"\n        src=\"/static/15a6326dd5cab22c18052ed4de99ea9a/e4c9a/mysql-vs-redis-median.png\"\n        srcset=\"/static/15a6326dd5cab22c18052ed4de99ea9a/1d79a/mysql-vs-redis-median.png 185w,\n/static/15a6326dd5cab22c18052ed4de99ea9a/1efb2/mysql-vs-redis-median.png 370w,\n/static/15a6326dd5cab22c18052ed4de99ea9a/e4c9a/mysql-vs-redis-median.png 591w\"\n        sizes=\"(max-width: 591px) 100vw, 591px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>And if we look at the maximum request duration, it’s even worse. Meaning that MySQL consumes much more CPU than Redis:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9633a40d4c04ff1dbd6cc09c55b6d270/e4c9a/mysql-vs-redis-max.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1UlEQVQ4y4VUi3KEIAz0/z+z7VXkoYInPnhsJ1GU69y0mckQAyzZTcZmnmeQL8uC5/N5xbTSN/m6rijnvPcIIWDf97fe0IXH4wFrLYQQ7H3fQykFIVpIKRlUaQ1jDMd/WZNS4qCAksUYkXPGskU4N2HxHmld4ZzjKmm/dqo4poSUMxr6oMuFBsUxBNBD4zNCKg1nR4Rx4GqHYeC94gyaEjIB+/mukIxiAiwrcrVX0Spg+cwzsFaI3qMhkclrqvearjjFeFXEgAQ0OQQpEDqB5GfONUSh6zq0bQutNV8m6kUb1qfoVOUCdbUTCNt2nE+J8804jtxRsqLnVVWhVsnAlRIbZxGn6ai0YtZQ5wj0HeW3gGc3g5bIVXMuQAKj+SK7ulwB34fTAUAPjwPi5I6mnKPzAkja/ach52jPWWxaIpya/daZm1IqjFXpOeVrcPM5PnnfEJRkyq+zWFGml2t93hllnduwdRLI8czmX37MY0OoxeZphvyQUJ8S6ktBfiroryM2Hy2U8ZA2QI8btN1g3M6r4u8dfg03IFVI1I3qIR4CRhqI7w7ddwdrDMahh3UOQhooM7JLPaBTPbvuLUw/vFZYKJNG5ZF8xvco3edJW3a+l/m39wO7h+LIyfZwSgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MySQL vs Redis: max request duration, microseconds\"\n        title=\"MySQL vs Redis: max request duration, microseconds\"\n        src=\"/static/9633a40d4c04ff1dbd6cc09c55b6d270/e4c9a/mysql-vs-redis-max.png\"\n        srcset=\"/static/9633a40d4c04ff1dbd6cc09c55b6d270/1d79a/mysql-vs-redis-max.png 185w,\n/static/9633a40d4c04ff1dbd6cc09c55b6d270/1efb2/mysql-vs-redis-max.png 370w,\n/static/9633a40d4c04ff1dbd6cc09c55b6d270/e4c9a/mysql-vs-redis-max.png 591w\"\n        sizes=\"(max-width: 591px) 100vw, 591px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>For sure, MySQL doesn’t fit this use case at all. It makes a lot of sense, the strength of MySQL isn’t here, but in stability, replication, transactions and many more.</p>\n<p>It was fun (as usual) to benchmark different aspects of MySQL. I also happy that I don’t need to write housekeeping code for thread local connection pool to benchmark it (I guess it was more than 4 years in my backlog), because I’d rather explore async access to MySQL and not blocking.</p>\n<p>Full data and charts for <a href=\"https://docs.google.com/spreadsheets/d/1KIqIylWCsy0pc6a9gTDzlckxCe3ppbMu3f7OaIlnnAg\">MySQL</a> and <a href=\"https://docs.google.com/spreadsheets/d/1f4gG-muUXa_wYlLxlLMRUk4cRT8UQCfLxoGgza-Mv-k\">MySQL vs Redis</a>. Source code is on <a href=\"https://github.com/dkomanov/stuff/commit/30101587ec9ecaddcf0e0f706f4565b22e3d5739\">GitHub</a>. Originally posted on <a href=\"https://dkomanov.medium.com/mysql-as-redis-vs-redis-74b788af9c6f\">Medium</a>. <a href=\"https://pixabay.com/illustrations/truck-vehicle-transport-cut-off-6578684/\">Cover image</a> by <a href=\"https://pixabay.com/users/divotomezove-1979640\">divotomezove</a> from <a href=\"https://pixabay.com/\">Pixabay</a>.</p>","fields":{"slug":"/p/mysql-as-redis-vs-redis/"},"frontmatter":{"rawDate":"2022-09-05T00:00:00.000Z","date":"September 05, 2022","title":"MySQL as Redis vs Redis?","description":"Simple one column table in MySQL representing a Set. Let's benchmark it (against Redis)!","tags":["java","mysql","benchmark","performance"],"canonicalUrl":"https://dkomanov.medium.com/mysql-as-redis-vs-redis-74b788af9c6f","cover":null}}},"pageContext":{"slug":"/p/mysql-as-redis-vs-redis/","previous":{"fields":{"slug":"/p/ultimate-off-heap-hash-set-using-redis/"}},"next":{"fields":{"slug":"/p/replacing-hash-map-with-off-heap-hash-map-in-java/"}}}},"staticQueryHashes":["3675711862"]}