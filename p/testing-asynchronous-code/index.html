<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.0308b565c95247786d6d.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}article{padding:40px 0;border-bottom:1px solid #f2f2f0}article:last-child{border-bottom:0}article .post-title{letter-spacing:-.02em;font-weight:700;font-style:normal;display:block;font-size:28px;line-height:1.1;margin:0}article .post-title a{text-decoration:none;color:#333332}article .post-title a:hover{text-decoration:none}article .post-description{letter-spacing:-.02em;font-weight:300;font-style:normal;font-size:20px;line-height:1.3;color:#666665}article .post-meta{font-size:14px;color:#b3b3b1;line-height:30px}article .post-meta time{margin:0 1em 0 0;vertical-align:middle}ul.pagination{list-style:none;padding:0;margin:1em 0 0}ul.pagination li{color:#b3b3b1;float:left;padding:0 10px 0 0}ul.pagination li.active{font-weight:700}ul.pagination li a,ul.pagination li a:visited{color:#b3b3b1;text-decoration:none}.btn{background-color:transparent;border:none;cursor:pointer;text-decoration:underline;outline:0;display:inline;margin:0;padding:0}.btn:focus,.btn:hover{text-decoration:none}.table-toggler{text-align:center}.table-toggler a{font-size:.7em;border-bottom:1px dotted #000;cursor:pointer}.raw-data-table table{width:100%}.raw-data-table table th{background-color:rgba(0,0,0,.03)}.raw-data-table table .right{text-align:right}div.choose ul{padding:0;margin:.5em 0 0}div.choose ul li:first-child{border-radius:5px 0 0 5px}div.choose ul li:last-child{border-radius:0 5px 5px 0}div.choose ul li{line-height:1.4;background-color:rgba(0,0,0,.05);color:rgba(0,0,0,.68);padding:3px .5em;cursor:pointer;min-width:40px;text-align:center}div.choose ul li.active,div.choose ul li:hover{background-color:rgba(0,0,0,.15)}div.choose ul li.active{cursor:default}div.choose label{background-color:rgba(0,0,0,.05);color:rgba(0,0,0,.68);padding:5px;margin:0 .5em 0 0;display:inline-block;vertical-align:bottom}body{margin:0;padding:0;font-size:1.2em;font-family:Open Sans,MundoSans,Helvetica Neue,Arial,Helvetica,sans-serif;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-ms-font-feature-settings:"liga","dlig";-o-font-feature-settings:"liga","dlig";font-feature-settings:"liga","dlig"}.cf:after{content:"";display:table;clear:both}ul.horizontal{list-style:none;padding:0;margin:0;vertical-align:top;display:inline-block}ul.horizontal li{float:left}.site-header{width:100%;max-width:740px;margin:0 auto;padding:0;position:relative;top:-140px;z-index:2;box-sizing:border-box}.site-header .site-logo{width:120px;height:120px;position:absolute;top:-60px;right:50%;margin-right:-60px;background-size:cover;background-image:url(data:image/jpeg;base64,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);border-radius:50%;z-index:99;text-indent:-9999px;border:3px solid #fff;background-color:#fff;box-shadow:0 1px 1px rgba(0,0,0,.3)}.site-header .site-title{margin:0;padding:84px 16px 8px;font-size:50px;text-align:center;font-weight:700;letter-spacing:-2px;outline:0;line-height:50px;word-break:break-word;color:#fff}.site-header .site-description{margin:0 0 20px;padding:0 32px;font-size:18px;line-height:1.5;color:#666;text-align:center;font-weight:400}.site-content{width:100%;max-width:740px;margin:0 auto;box-sizing:border-box;top:-140px;position:relative}.wide-content{width:96vw;position:relative;display:block;left:50%;right:50%;margin-left:-48vw;margin-right:-48vw}@media only screen and (max-width:800px){.site-content{padding:0 32px}}.markdown{width:100%;color:#333}.markdown,.markdown h1,.markdown h2,.markdown h3{font-family:Linux Libertine,serif}.markdown h3,.markdown h4,.markdown h5,.markdown h6{letter-spacing:-.02em;font-weight:700;font-style:normal;font-size:24px;line-height:1.3;font-family:Linux Libertine,serif;margin:0 0 4px}.markdown h1,.markdown h2{letter-spacing:-.02em;font-weight:700;font-style:normal;font-size:32px;line-height:1.2;padding-top:31px;margin-bottom:4px}.markdown p{font-weight:400;font-style:normal;font-size:22px;line-height:30px;margin:0;padding-bottom:30px;color:#333;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.markdown a{color:#333;text-decoration:underline}.markdown img{max-width:100%;margin:0 auto}.markdown figure{margin:0;padding:0 0 30px}.markdown figcaption{font-weight:400;font-style:italic;font-size:16px;line-height:1.3;color:#666665;outline:0;z-index:300;text-align:center}.markdown hr{border:0;padding:0;display:block;width:15%;margin:30px auto;border-top:1px solid #ddd}.markdown blockquote{margin:0 0 30px -26px}.markdown blockquote,.markdown blockquote p{border-left:3px solid #57ad68;padding-left:20px}.markdown blockquote p{letter-spacing:.01rem;font-weight:400;font-style:italic;margin-left:-26px;padding-bottom:3px}.markdown ol,.markdown ul{padding:0 0 30px;margin:0}.markdown li{font-weight:400;font-style:normal;font-size:23px;line-height:30px;margin-left:30px;margin-bottom:12px;padding:2px 0 0}.markdown li p{padding:0 0 1.618rem}.markdown ol li{list-style-type:decimal}.markdown code{font-family:Courier,monospace;font-size:16px}.markdown.tiny *{font-size:16px;line-height:1.2em}.markdown.tiny ul{padding:0}.markdown.tiny ul li{margin-bottom:0}footer{margin:0 auto;padding:22px 0;width:100%;max-width:640px;font-size:12px;text-align:center;color:#999;line-height:17.6px}footer a{color:#666;text-decoration:none}footer a:hover{color:#333}.share-buttons{display:inline-block}.share-buttons .share-button{vertical-align:top;display:inline-block;margin:0 0 0 .5em;text-align:center}.site-menu{margin:0 0 50px;text-align:center;color:#ccc}.site-menu a{text-decoration:none;color:#999;padding-left:20px}.site-menu a:hover{color:#333}.site-menu a.active{font-weight:700}ul.tags{list-style:none;padding:0;margin:0;vertical-align:top;display:inline-block}ul.tags li{line-height:1.4;border-radius:3px;background-color:rgba(0,0,0,.05);float:left;margin:4px .5em 0 0;padding:3px 5px}ul.tags li:hover{background-color:rgba(0,0,0,.15)}ul.tags li.label{padding:0 .5em 0 0}ul.tags li a,ul.tags li a:visited{color:rgba(0,0,0,.68);text-decoration:none}.teaser-image{height:360px;position:relative;overflow:hidden;background-color:#000}.teaser-image_image{background-size:cover;background-position:50%;position:absolute;top:0;left:0;right:0;bottom:0;z-index:1;text-indent:-9999px}.time-units p.small{margin:0 0 10px}.time-units small{font-size:12px;color:rgba(0,0,0,.3)}.site-content.no-cover{top:0;position:relative}.no-cover .post-meta{padding-top:60px}.no-cover .post-title{font-weight:700;font-style:normal;letter-spacing:-.04em;font-size:50px;line-height:1.1;color:#333332;margin-bottom:16px}.no-cover .author-image{display:inline-block;width:30px;height:30px;line-height:30px;margin-right:8px;margin-bottom:-10px;float:left;background-size:cover;background-image:url(/img/top-logo.jpg);border-radius:100%;text-indent:-9999px}.no-cover .author-name{display:inline}.no-cover .post-meta-text{color:#b3b3b1;letter-spacing:-.02em;font-weight:400;font-style:normal;font-size:14px;white-space:nowrap;text-overflow:ellipsis}.blog-post-meta{color:#b3b3b1}ul.what-i-read{list-style-type:none;margin:0;padding:0}ul.what-i-read>li{display:inline-block;padding:0 10px 0 0}</style><meta name="generator" content="Gatsby 2.16.1"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Severe Software Developer Blog" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=76ff8c065a5c5bb5970928d570458342"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=76ff8c065a5c5bb5970928d570458342"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=76ff8c065a5c5bb5970928d570458342"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=76ff8c065a5c5bb5970928d570458342"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=76ff8c065a5c5bb5970928d570458342"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=76ff8c065a5c5bb5970928d570458342"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=76ff8c065a5c5bb5970928d570458342"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=76ff8c065a5c5bb5970928d570458342"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=76ff8c065a5c5bb5970928d570458342"/><title data-react-helmet="true">Testing Asynchronous Code | @dkomanov</title><meta data-react-helmet="true" name="description" content="Some tricks how to reliably test multithreaded code in Java/Scala..."/><meta data-react-helmet="true" property="og:title" content="Testing Asynchronous Code"/><meta data-react-helmet="true" property="og:description" content="Some tricks how to reliably test multithreaded code in Java/Scala..."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Dmitry Komanov"/><meta data-react-helmet="true" name="twitter:title" content="Testing Asynchronous Code"/><meta data-react-helmet="true" name="twitter:description" content="Some tricks how to reliably test multithreaded code in Java/Scala..."/><link as="script" rel="preload" href="/webpack-runtime-e8927a72a79a53065725.js"/><link as="script" rel="preload" href="/app-f199cc0495ce18e41626.js"/><link as="script" rel="preload" href="/styles-82ec6d418805c947958f.js"/><link as="script" rel="preload" href="/commons-b08a3f87ee444e5a948d.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-e3c506d60d74c4c30ac2.js"/><link as="fetch" rel="preload" href="/page-data/p/testing-asynchronous-code/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div><div class="teaser-image"><div class="teaser-image_image" style="background-image:url(/static/cover-272d2b284acc8b44f18aee5d86d4070b.jpg);transform:translate3d(0px, 0px, 0px);opacity:1">Teaser Image</div></div><header class="site-header"><a class="site-logo" href="/">@dkomanov</a><h1 class="site-title">@dkomanov</h1><div class="site-description">Severe Software Developer Blog</div><div class="site-menu"><a href="/">Blog</a><a href="/what-i-read">What I Read</a><a href="/about">About</a></div></header><div class="site-content"><div class="blog-post" itemscope="" itemType="http://schema.org/Article"><h1></h1><div class="markdown " role="main"><p>Recently I’ve fixed a flaky test and I want to share some thoughts (very trivial)
about how to make no mistakes. So, we have a simple class Throttler for dealing
high load on a some part of code (basically it’s a wrapper around
<a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Semaphore.html">Semaphore</a>):</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">class</span> ThrottledException <span class="token keyword">extends</span> RuntimeException<span class="token punctuation">(</span><span class="token string">"Throttled!"</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> Throttler<span class="token punctuation">(</span>count<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> Semaphore<span class="token punctuation">(</span>count<span class="token punctuation">)</span>
  <span class="token keyword">def</span> apply<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token keyword">=></span> <span class="token builtin">Unit</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>semaphore<span class="token punctuation">.</span>tryAcquire<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> ThrottledException
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      f
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      semaphore<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I use <a href="https://etorreborre.github.io/specs2/">specs2</a> for a testing. The first test will be sequential
(very simple):</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">class</span> ThrottlerTest <span class="token keyword">extends</span> Specification <span class="token punctuation">{</span>
  <span class="token string">"Throttler"</span> should <span class="token punctuation">{</span>
    <span class="token string">"execute sequential"</span> in <span class="token keyword">new</span> ctx <span class="token punctuation">{</span>
      <span class="token keyword">var</span> invocationCount <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">0</span> to maxCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        throttler <span class="token punctuation">{</span>
          invocationCount <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      invocationCount must be_<span class="token operator">==</span><span class="token punctuation">(</span>maxCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">trait</span> ctx <span class="token punctuation">{</span>
    <span class="token keyword">val</span> maxCount <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">val</span> throttler <span class="token operator">=</span> <span class="token keyword">new</span> Throttler<span class="token punctuation">(</span>maxCount<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Ok. Now we need to test that our Throttler works well in a multithreaded environment.
Let’s prepare for an async test and add some support code to ctx trait:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">val</span> e <span class="token operator">=</span> Executors<span class="token punctuation">.</span>newCachedThreadPool<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">implicit</span> <span class="token keyword">val</span> ec<span class="token operator">:</span> ExecutionContext<span class="token operator">=</span>ExecutionContext<span class="token punctuation">.</span>fromExecutor<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token keyword">val</span> waitForeverLatch <span class="token operator">=</span> <span class="token keyword">new</span> CountDownLatch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> after<span class="token operator">:</span> <span class="token builtin">Any</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  waitForeverLatch<span class="token punctuation">.</span>countDown<span class="token punctuation">(</span><span class="token punctuation">)</span>
  e<span class="token punctuation">.</span>shutdownNow<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">def</span> waitForever<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token punctuation">{</span>
  waitForeverLatch<span class="token punctuation">.</span>await<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> _<span class="token operator">:</span> InterruptedException <span class="token keyword">=></span>
  <span class="token keyword">case</span> ex<span class="token operator">:</span> Throwable <span class="token keyword">=></span> <span class="token keyword">throw</span> ex
<span class="token punctuation">}</span></code></pre></div>
<p>ExecutionContext is for Future construction, waitForever method is to sleep to the
end of test. In the after function we shutdown an executor service.</p>
<p>A naive way to test multithreaded behavior of the Throttler will be:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token string">"throw exception once reached the limit [naive,flaky]"</span> in <span class="token keyword">new</span> ctx <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to maxCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Future <span class="token punctuation">{</span>
      throttler<span class="token punctuation">(</span>waitForever<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  throttler <span class="token punctuation">{</span><span class="token punctuation">}</span> must throwA<span class="token punctuation">[</span>ThrottledException<span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>We’re creating maxCount Futures that calls function waitForever which is waiting
until the end of test. Of course this naive way almost doesn’t work. Plenty of
times we will be exception expectation error: the last call for a throttler
(with expectation) may occur before one of futures start (and exception will
be thrown in this future).</p>
<p>To fix it we need to wait somehow until all futures starts. Here is an approach
that is familiar to many of us:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token string">"throw exception once reached the limit [naive, bad]"</span> in <span class="token keyword">new</span> ctx <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to maxCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Future <span class="token punctuation">{</span>
      throttler<span class="token punctuation">(</span>waitForever<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  Thread<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  throttler <span class="token punctuation">{</span><span class="token punctuation">}</span> must throwA<span class="token punctuation">[</span>ThrottledException<span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Yes, just add a sleep method call with some reasonable duration. Ok, now our test
will pass almost always, but… This approach is wrong at least by two reasons:</p>
<ul>
<li>A duration of test will be as long as “reasonable duration”</li>
<li>Sometimes (in very rare situations like machine is under high load) it
won’t work — this reasonable duration won’t be enough.</li>
</ul>
<p>If you’re still doubt about it — ask <a href="https://www.google.com/?q=why+thread+sleep+is+a+bad+practice+java">Google</a> for more
reasoning. Now we will try to synchronize start of futures and our expectation.
Let use CountDownLatch class from java.util.concurrent:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token string">"throw exception once reached the limit [working]"</span> in <span class="token keyword">new</span> ctx <span class="token punctuation">{</span>
  <span class="token keyword">val</span> barrier <span class="token operator">=</span> <span class="token keyword">new</span> CountDownLatch<span class="token punctuation">(</span>maxCount<span class="token punctuation">)</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to maxCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Future <span class="token punctuation">{</span>
      throttler <span class="token punctuation">{</span>
        barrier<span class="token punctuation">.</span>countDown<span class="token punctuation">(</span><span class="token punctuation">)</span>
        waitForever<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  barrier<span class="token punctuation">.</span>await<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span> must beTrue

  throttler <span class="token punctuation">{</span><span class="token punctuation">}</span> must throwA<span class="token punctuation">[</span>ThrottledException<span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>We use CountDownLatch for a <a href="https://en.wikipedia.org/wiki/Barrier_%28computer_science%29">barrier synchronization</a>.
Await method will wait until latch count won’t reach zero. And just to mention,
we use a little bit higher timeout for waiting. It’s just to avoid failing in
rare cases, it won’t affect on test duration (it will be much less than a second).</p>
<p>Instead of a conclusion I want to share with my own rule about Thread.sleep.
I use it only to check a hypothesis (in case when I’m not sure) — it takes a bit
less time to insert sleep on a certain place. And in general when I’m thinking
about sleeping I use CountDownLatch. Even for a trivial waiting (like waitForever
function, I could use something like <code class="language-text">Thread.sleep(Long.MAX_VALUE)</code>) because it’s
always better not to use fragile approach at all.</p>
<p>Related links:</p>
<ul>
<li><a href="https://github.com/dkomanov/scala-junk/blob/master/src/test/scala/com/komanov/examples/ThrottlerTest.scala">Code</a> related to the post.</li>
<li>Reworked version in <a href="http://engineering.wix.com/2015/10/07/testing-asynchronous-code/">Wix Blog</a>.</li>
<li>Republished version on <a href="http://www.javacodegeeks.com/2015/10/testing-asynchronous-code.html">javacodegeeks</a>.</li>
<li><a href="https://pixabay.com/en/ancient-art-background-cosmos-dark-764930/">Cover image</a></li>
</ul></div></div><div class="blog-post-meta"><ul class="tags"><li class="cf"><a href="/posts/scala">scala</a></li><li class="cf"><a href="/posts/specs2">specs2</a></li><li class="cf"><a href="/posts/async">async</a></li><li class="cf"><a href="/posts/testing">testing</a></li></ul><hr/><div class="share-buttons"><div aria-label="twitter" role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--twitter share-button"><div style="width:24px;height:24px"><svg viewBox="0 0 64 64" width="24" height="24" class="social-icon social-icon--twitter "><g><rect width="64" height="64" rx="0" ry="0" fill="#00aced"></rect></g><g><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></g></svg></div></div><div aria-label="facebook" role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--facebook share-button"><div style="width:24px;height:24px"><svg viewBox="0 0 64 64" width="24" height="24" class="social-icon social-icon--facebook "><g><rect width="64" height="64" rx="0" ry="0" fill="#3b5998"></rect></g><g><path d="M34.1,47V33.3h4.6l0.7-5.3h-5.3v-3.4c0-1.5,0.4-2.6,2.6-2.6l2.8,0v-4.8c-0.5-0.1-2.2-0.2-4.1-0.2 c-4.1,0-6.9,2.5-6.9,7V28H24v5.3h4.6V47H34.1z" fill="white"></path></g></svg></div></div></div></div></div><footer>All content ©<!-- --> <a href="mailto:dkomanov@gmail.com">Dmitry Komanov</a>,<!-- --> <a href="/powered">powered by...</a></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/p/testing-asynchronous-code/";window.webpackCompilationHash="a8150f80a47cc5264375";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-f199cc0495ce18e41626.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-420dcf03d3ee4d14b1c1.js"],"component---src-templates-blog-by-tag-js":["/component---src-templates-blog-by-tag-js-af99b4353432d7e6a17e.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e3c506d60d74c4c30ac2.js"],"component---src-templates-static-js":["/component---src-templates-static-js-a1d5f65647e02c620803.js"],"component---src-templates-what-i-read-index-js":["/component---src-templates-what-i-read-index-js-bbc84838b9720db6529b.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c7e17eb28ca27d8da16b.js"],"component---src-pages-charts-mysql-streaming-index-js":["/component---src-pages-charts-mysql-streaming-index-js-913e21df421f5411813d.js"],"component---src-pages-charts-read-lines-index-js":["/component---src-pages-charts-read-lines-index-js-525ebde641e92477e84e.js"],"component---src-pages-charts-read-utf-8-index-js":["/component---src-pages-charts-read-utf-8-index-js-0156a0d78c4d1989b3fd.js"],"component---src-pages-charts-scala-serialization-index-js":["/component---src-pages-charts-scala-serialization-index-js-6027ee92e8aed164fb25.js"],"component---src-pages-charts-scala-string-format-index-js":["/component---src-pages-charts-scala-string-format-index-js-dda11d074959c2903206.js"],"component---src-pages-index-js":["/component---src-pages-index-js-05700cbf6b3ebca566b4.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-e3c506d60d74c4c30ac2.js" async=""></script><script src="/commons-b08a3f87ee444e5a948d.js" async=""></script><script src="/styles-82ec6d418805c947958f.js" async=""></script><script src="/app-f199cc0495ce18e41626.js" async=""></script><script src="/webpack-runtime-e8927a72a79a53065725.js" async=""></script></body></html>